<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM Strategy OS ‚Äî Evaluation & Skills Framework</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --surface: #111118;
  --surface2: #18181f;
  --border: #2a2a35;
  --accent: #e8ff47;
  --accent2: #ff6b35;
  --accent3: #47c4ff;
  --accent4: #c47aff;
  --text: #f0f0f5;
  --text2: #8888a0;
  --text3: #555568;
  --red: #ff4444;
  --amber: #ffaa00;
  --green: #44dd88;
  --green-dim: #1a3d2b;
  --amber-dim: #3d2e00;
  --red-dim: #3d0f0f;
  --r: 8px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 13px;
  line-height: 1.6;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  background: rgba(10,10,15,0.92);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 0; height: 52px;
  padding: 0 24px;
}
.nav-logo {
  font-family: 'Syne', sans-serif;
  font-weight: 800; font-size: 15px;
  color: var(--accent);
  letter-spacing: -0.5px;
  margin-right: 32px;
  white-space: nowrap;
}
.nav-tabs { display: flex; gap: 2px; flex: 1; }
.nav-tab {
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
  color: var(--text2);
  font-size: 11px;
  font-family: 'DM Mono', monospace;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.2s;
  white-space: nowrap;
  border: none; background: transparent;
}
.nav-tab:hover { color: var(--text); background: var(--surface2); }
.nav-tab.active { color: var(--accent); background: rgba(232,255,71,0.08); }

.nav-right { display: flex; align-items: center; gap: 10px; margin-left: auto; }
.mode-badge {
  padding: 4px 12px; border-radius: 20px;
  font-size: 10px; font-weight: 500; letter-spacing: 1px;
  background: rgba(232,255,71,0.1);
  border: 1px solid rgba(232,255,71,0.3);
  color: var(--accent);
  cursor: pointer;
}
.save-btn {
  padding: 6px 16px; border-radius: 6px;
  background: var(--accent); color: #0a0a0f;
  font-family: 'DM Mono', monospace;
  font-size: 11px; font-weight: 500;
  border: none; cursor: pointer;
  transition: opacity 0.2s;
}
.save-btn:hover { opacity: 0.85; }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
main { margin-top: 52px; }
.view { display: none; padding: 28px 28px 60px; }
.view.active { display: block; }

/* ‚îÄ‚îÄ HERO HEADER ‚îÄ‚îÄ */
.page-header {
  margin-bottom: 28px;
  display: flex; align-items: flex-end; justify-content: space-between;
}
.page-title {
  font-family: 'Syne', sans-serif;
  font-size: 28px; font-weight: 800;
  letter-spacing: -1px;
  line-height: 1.1;
}
.page-title span { color: var(--accent); font-family: 'Instrument Serif', serif; font-style: italic; }
.page-sub { color: var(--text2); font-size: 11px; margin-top: 6px; }

/* ‚îÄ‚îÄ CARDS & GRIDS ‚îÄ‚îÄ */
.grid { display: grid; gap: 16px; }
.g2 { grid-template-columns: repeat(2, 1fr); }
.g3 { grid-template-columns: repeat(3, 1fr); }
.g4 { grid-template-columns: repeat(4, 1fr); }
.g1-2 { grid-template-columns: 1fr 2fr; }
.g2-1 { grid-template-columns: 2fr 1fr; }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 20px;
}
.card-title {
  font-family: 'Syne', sans-serif;
  font-size: 11px; font-weight: 700;
  letter-spacing: 2px;
  color: var(--text2);
  text-transform: uppercase;
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 8px;
}
.card-title .dot {
  width: 6px; height: 6px; border-radius: 50%;
  display: inline-block;
}

/* ‚îÄ‚îÄ STAT TILES ‚îÄ‚îÄ */
.stat-tile {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 18px;
}
.stat-num {
  font-family: 'Syne', sans-serif;
  font-size: 36px; font-weight: 800;
  letter-spacing: -2px;
  line-height: 1;
}
.stat-label { color: var(--text2); font-size: 10px; letter-spacing: 1px; margin-top: 6px; }
.stat-delta { font-size: 10px; margin-top: 4px; }
.up { color: var(--green); }
.down { color: var(--red); }

/* ‚îÄ‚îÄ SKILL DOMAINS ‚îÄ‚îÄ */
.domain-block {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
}
.domain-header {
  padding: 14px 18px;
  display: flex; align-items: center; justify-content: space-between;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
}
.domain-name {
  font-family: 'Syne', sans-serif;
  font-weight: 700; font-size: 13px;
}
.domain-score-bar {
  display: flex; align-items: center; gap: 10px;
}
.bar-track {
  width: 120px; height: 4px;
  background: var(--surface2);
  border-radius: 2px; overflow: hidden;
}
.bar-fill {
  height: 100%; border-radius: 2px;
  transition: width 0.6s cubic-bezier(.4,0,.2,1);
}
.score-chip {
  font-size: 11px; font-weight: 600;
  font-family: 'Syne', sans-serif;
  min-width: 28px; text-align: right;
}
.rag-dot {
  width: 8px; height: 8px; border-radius: 50%;
  flex-shrink: 0;
}

.domain-body { padding: 0; }
.skill-row {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 18px;
  border-bottom: 1px solid rgba(42,42,53,0.5);
  transition: background 0.15s;
}
.skill-row:last-child { border-bottom: none; }
.skill-row:hover { background: rgba(255,255,255,0.02); }
.skill-name { flex: 1; color: var(--text2); font-size: 11px; }
.skill-name strong { color: var(--text); display: block; font-weight: 500; margin-bottom: 1px; }
.skill-controls { display: flex; align-items: center; gap: 8px; }

input[type=range] {
  -webkit-appearance: none;
  width: 100px; height: 3px;
  background: var(--surface2);
  border-radius: 2px; outline: none;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px; height: 14px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  transition: transform 0.1s;
}
input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

.score-display {
  font-family: 'Syne', sans-serif;
  font-size: 13px; font-weight: 700;
  min-width: 20px; text-align: center;
}
.rag-badge {
  font-size: 9px; font-weight: 600;
  padding: 2px 7px; border-radius: 4px;
  letter-spacing: 0.5px;
}
.rag-G { background: var(--green-dim); color: var(--green); }
.rag-A { background: var(--amber-dim); color: var(--amber); }
.rag-R { background: var(--red-dim); color: var(--red); }
.weight-input {
  width: 44px; padding: 3px 6px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 4px; color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 11px; text-align: center;
}

/* ‚îÄ‚îÄ MODE SELECTOR ‚îÄ‚îÄ */
.mode-pills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
.mode-pill {
  padding: 6px 16px; border-radius: 20px;
  font-size: 11px; font-weight: 500;
  border: 1px solid var(--border);
  background: transparent; color: var(--text2);
  cursor: pointer; transition: all 0.2s;
  font-family: 'DM Mono', monospace;
}
.mode-pill:hover { border-color: var(--accent); color: var(--accent); }
.mode-pill.active {
  background: var(--accent); color: #0a0a0f;
  border-color: var(--accent);
}

/* ‚îÄ‚îÄ FLOW DIAGRAM ‚îÄ‚îÄ */
#flow-canvas {
  width: 100%; height: 600px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  position: relative; overflow: hidden;
}
.flow-node {
  position: absolute;
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: 10px;
  padding: 12px 16px;
  cursor: pointer;
  transition: all 0.2s;
  min-width: 130px;
  text-align: center;
  user-select: none;
}
.flow-node:hover { border-color: var(--accent); transform: translateY(-2px); }
.flow-node.center-node {
  background: rgba(232,255,71,0.08);
  border-color: var(--accent);
  min-width: 160px;
}
.flow-node .fn-title {
  font-family: 'Syne', sans-serif;
  font-weight: 700; font-size: 12px;
}
.flow-node .fn-sub { color: var(--text2); font-size: 9px; margin-top: 3px; }
.flow-node .fn-score {
  font-family: 'Syne', sans-serif;
  font-weight: 800; font-size: 18px;
  color: var(--accent); margin-top: 6px;
}
svg.flow-svg {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
}

/* ‚îÄ‚îÄ INITIATIVE MATRIX ‚îÄ‚îÄ */
.initiative-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 12px;
  height: 420px;
}
.quadrant {
  border-radius: var(--r);
  padding: 16px;
  position: relative;
  overflow: hidden;
}
.q-label {
  font-family: 'Syne', sans-serif;
  font-size: 10px; font-weight: 700;
  letter-spacing: 1.5px; text-transform: uppercase;
  margin-bottom: 12px; opacity: 0.7;
}
.q1 { background: rgba(68,221,136,0.06); border: 1px solid rgba(68,221,136,0.2); }
.q2 { background: rgba(71,196,255,0.06); border: 1px solid rgba(71,196,255,0.2); }
.q3 { background: rgba(255,170,0,0.06); border: 1px solid rgba(255,170,0,0.2); }
.q4 { background: rgba(255,68,68,0.06); border: 1px solid rgba(255,68,68,0.2); }

.initiative-chip {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 10px; margin: 3px;
  border-radius: 6px;
  font-size: 10px; font-weight: 500;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer; transition: all 0.2s;
}
.initiative-chip:hover { background: rgba(255,255,255,0.1); }

/* ‚îÄ‚îÄ CORRELATION MAP ‚îÄ‚îÄ */
.corr-table { width: 100%; border-collapse: collapse; }
.corr-table th {
  font-size: 9px; letter-spacing: 1px;
  color: var(--text2); text-transform: uppercase;
  padding: 8px 10px; text-align: left;
  border-bottom: 1px solid var(--border);
}
.corr-table td {
  padding: 9px 10px;
  border-bottom: 1px solid rgba(42,42,53,0.5);
  font-size: 11px;
}
.corr-chip {
  padding: 2px 8px; border-radius: 4px;
  font-size: 9px; font-weight: 600;
}
.corr-strong { background: rgba(68,221,136,0.15); color: var(--green); }
.corr-moderate { background: rgba(255,170,0,0.15); color: var(--amber); }
.corr-weak { background: rgba(255,255,255,0.08); color: var(--text2); }
.corr-inverse { background: rgba(255,68,68,0.15); color: var(--red); }

/* ‚îÄ‚îÄ TEMPLATE VIEW ‚îÄ‚îÄ */
.template-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
.template-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s;
}
.template-card:hover { border-color: var(--accent2); transform: translateY(-3px); }
.template-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.template-icon {
  width: 32px; height: 32px; border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
}
.template-body { padding: 16px; }
.template-step {
  display: flex; gap: 10px; margin-bottom: 10px;
  align-items: flex-start;
}
.step-num {
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  font-size: 9px; font-weight: 600; color: var(--text2);
  flex-shrink: 0; margin-top: 1px;
}
.step-text { font-size: 10px; color: var(--text2); line-height: 1.5; }
.step-text strong { color: var(--text); display: block; font-size: 11px; }

/* ‚îÄ‚îÄ TEMPLATE OVERLAY ‚îÄ‚îÄ */
.overlay-backdrop {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(5,5,10,0.85);
  backdrop-filter: blur(12px);
  display: flex; align-items: flex-start; justify-content: center;
  padding: 24px 16px 40px;
  overflow-y: auto;
  opacity: 0; pointer-events: none;
  transition: opacity 0.25s;
}
.overlay-backdrop.open { opacity: 1; pointer-events: all; }

.overlay-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  width: 100%; max-width: 960px;
  transform: translateY(24px);
  transition: transform 0.3s cubic-bezier(.4,0,.2,1);
  overflow: hidden;
}
.overlay-backdrop.open .overlay-panel { transform: translateY(0); }

.overlay-topbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 18px 24px;
  border-bottom: 1px solid var(--border);
  background: var(--surface2);
}
.overlay-title {
  font-family: 'Syne', sans-serif;
  font-size: 17px; font-weight: 800;
  display: flex; align-items: center; gap: 10px;
}
.overlay-actions { display: flex; gap: 8px; align-items: center; }
.overlay-close {
  width: 32px; height: 32px; border-radius: 8px;
  background: var(--surface); border: 1px solid var(--border);
  color: var(--text2); cursor: pointer; font-size: 16px;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.overlay-close:hover { background: var(--red-dim); color: var(--red); border-color: var(--red); }

.overlay-body { padding: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
@media(max-width:700px) { .overlay-body { grid-template-columns: 1fr; } }

.overlay-section-title {
  font-family: 'Syne', sans-serif;
  font-size: 10px; font-weight: 700;
  letter-spacing: 2px; text-transform: uppercase;
  color: var(--text2); margin-bottom: 12px;
  display: flex; align-items: center; gap: 6px;
}

/* Editable workspace table */
.ws-table { width: 100%; border-collapse: collapse; }
.ws-table th {
  font-size: 9px; letter-spacing: 1px; text-transform: uppercase;
  color: var(--text2); padding: 7px 8px;
  border-bottom: 1px solid var(--border);
  background: var(--surface2); text-align: left;
}
.ws-table td { padding: 0; border-bottom: 1px solid rgba(42,42,53,0.4); }
.ws-table td:first-child {
  padding: 8px; font-size: 10px; color: var(--text2);
  width: 28%; font-weight: 500; background: rgba(255,255,255,0.02);
  vertical-align: middle;
}
.ws-cell {
  width: 100%; padding: 8px;
  background: transparent; border: none;
  color: var(--text); font-family: 'DM Mono', monospace;
  font-size: 11px; resize: none; outline: none;
  min-height: 36px; line-height: 1.5;
  transition: background 0.15s;
}
.ws-cell:focus { background: rgba(232,255,71,0.04); }
.ws-cell::placeholder { color: var(--text3); }

/* Status select in table */
.ws-status {
  padding: 4px 8px; border-radius: 4px;
  font-size: 10px; font-weight: 600;
  border: 1px solid var(--border);
  background: var(--surface2); color: var(--text);
  font-family: 'DM Mono', monospace; cursor: pointer;
  width: 100%;
}

/* Correlation mini panel inside overlay */
.corr-mini { background: var(--surface2); border-radius: 8px; padding: 14px; }
.corr-mini-row {
  display: flex; align-items: flex-start; gap: 8px;
  padding: 8px 0; border-bottom: 1px solid rgba(42,42,53,0.4);
  font-size: 10px;
}
.corr-mini-row:last-child { border-bottom: none; }
.corr-mini-label { color: var(--text2); flex: 1; line-height: 1.5; }
.corr-mini-label strong { color: var(--text); display: block; margin-bottom: 2px; }

/* Notes area */
.ws-notes {
  width: 100%; min-height: 80px; padding: 10px 12px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 6px; color: var(--text);
  font-family: 'DM Mono', monospace; font-size: 11px;
  resize: vertical; outline: none; line-height: 1.6;
  transition: border-color 0.15s;
}
.ws-notes:focus { border-color: var(--accent); }
.ws-notes::placeholder { color: var(--text3); }

/* Download bar at bottom of overlay */
.overlay-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  background: var(--surface2);
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px; flex-wrap: wrap;
}
.overlay-footer-note { font-size: 10px; color: var(--text2); }
.dl-btns { display: flex; gap: 8px; }
.dl-btn {
  padding: 7px 16px; border-radius: 6px;
  font-family: 'DM Mono', monospace;
  font-size: 11px; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  border: 1px solid var(--border);
  display: flex; align-items: center; gap: 6px;
}
.dl-btn-primary { background: var(--accent); color: #0a0a0f; border-color: var(--accent); }
.dl-btn-primary:hover { opacity: 0.85; }
.dl-btn-secondary { background: transparent; color: var(--text2); }
.dl-btn-secondary:hover { background: var(--surface); color: var(--text); }
.dl-btn-all { background: rgba(71,196,255,0.1); color: var(--accent3); border-color: rgba(71,196,255,0.3); }
.dl-btn-all:hover { background: rgba(71,196,255,0.2); }

/* Download banner above template grid */
.dl-all-bar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 18px; margin-bottom: 20px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: var(--r);
}
.dl-all-bar-text { font-size: 11px; color: var(--text2); }
.dl-all-bar-text strong { color: var(--text); }

/* ‚îÄ‚îÄ INDUSTRY SELECTOR ‚îÄ‚îÄ */
.industry-pills { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px; }
.ind-pill {
  padding: 5px 12px; border-radius: 20px;
  font-size: 10px; border: 1px solid var(--border);
  background: transparent; color: var(--text2);
  cursor: pointer; transition: all 0.15s;
  font-family: 'DM Mono', monospace;
}
.ind-pill:hover { border-color: var(--accent3); color: var(--accent3); }
.ind-pill.active { background: var(--accent3); color: #0a0a0f; border-color: var(--accent3); }

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--surface); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ */
.tooltip {
  position: fixed; z-index: 999;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px; padding: 8px 12px;
  font-size: 11px; max-width: 220px;
  pointer-events: none; opacity: 0;
  transition: opacity 0.2s;
}

/* ‚îÄ‚îÄ SECTION DIVIDER ‚îÄ‚îÄ */
.divider { height: 1px; background: var(--border); margin: 24px 0; }
.section-label {
  font-size: 10px; letter-spacing: 2px;
  color: var(--text3); text-transform: uppercase;
  margin-bottom: 14px; margin-top: 28px;
}

/* ‚îÄ‚îÄ BUTTON ‚îÄ‚îÄ */
.btn {
  padding: 8px 18px; border-radius: 6px;
  font-family: 'DM Mono', monospace;
  font-size: 11px; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  border: 1px solid var(--border);
  background: transparent; color: var(--text2);
}
.btn:hover { background: var(--surface2); color: var(--text); }
.btn-primary {
  background: var(--accent); color: #0a0a0f;
  border-color: var(--accent);
}
.btn-primary:hover { opacity: 0.85; background: var(--accent); color: #0a0a0f; }

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}
.view.active .card,
.view.active .domain-block,
.view.active .stat-tile {
  animation: fadeUp 0.4s ease both;
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 900px) {
  .g3 { grid-template-columns: 1fr 1fr; }
  .template-grid { grid-template-columns: 1fr 1fr; }
  .g4 { grid-template-columns: 1fr 1fr; }
  .g1-2, .g2-1 { grid-template-columns: 1fr; }
}
@media (max-width: 600px) {
  .g2, .g3, .g4, .template-grid { grid-template-columns: 1fr; }
  nav { padding: 0 12px; }
  .view { padding: 16px 14px 60px; }
}
</style>
</head>
<body>

<nav>
  <div class="nav-logo">PM OS ‚¨°</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showView('dashboard')">Dashboard</button>
    <button class="nav-tab" onclick="showView('evaluation')">Evaluation</button>
    <button class="nav-tab" onclick="showView('flowmap')">Flow Map</button>
    <button class="nav-tab" onclick="showView('initiatives')">Initiatives</button>
    <button class="nav-tab" onclick="showView('templates')">Templates</button>
    <button class="nav-tab" onclick="showView('correlations')">Correlations</button>
  </div>
  <div class="nav-right">
    <span class="mode-badge" id="modeBadge" onclick="showView('evaluation')">‚¨° GROWTH MODE</span>
    <button class="save-btn" onclick="exportData()">‚Üì Export</button>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  VIEW 1: DASHBOARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view active" id="view-dashboard">
  <div class="page-header">
    <div>
      <div class="page-title">Strategy <span>Operating System</span></div>
      <div class="page-sub">PM ¬∑ CEO ¬∑ Growth ¬∑ Research ¬∑ Evaluation ¬∑ Initiatives</div>
    </div>
    <div style="display:flex;gap:8px;">
      <button class="btn" onclick="recalcAll()">‚Üª Recalculate</button>
      <button class="btn btn-primary" onclick="exportExecutiveSummary()">‚Üì Executive Summary</button>
    </div>
  </div>

  <!-- KPI Stats -->
  <div class="grid g4" id="statTiles" style="margin-bottom: 16px;">
    <div class="stat-tile">
      <div class="stat-num" id="overallScore" style="color:var(--accent)">‚Äî</div>
      <div class="stat-label">OVERALL SCORE / 10</div>
      <div class="stat-delta up" id="overallRag">‚Äî</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" id="greenCount" style="color:var(--green)">‚Äî</div>
      <div class="stat-label">GREEN SKILLS</div>
      <div class="stat-delta" style="color:var(--text2)" id="totalSkills">of ‚Äî skills</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" id="redCount" style="color:var(--red)">‚Äî</div>
      <div class="stat-label">RED / CRITICAL GAPS</div>
      <div class="stat-delta" id="redLabel" style="color:var(--text2)">needs attention</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" id="modeScoreDisplay" style="color:var(--accent3)">‚Äî</div>
      <div class="stat-label">MODE-WEIGHTED SCORE</div>
      <div class="stat-delta" style="color:var(--text2)" id="modeLabel">GROWTH</div>
    </div>
  </div>

  <!-- Domain Overview -->
  <div class="section-label">Skill Domains</div>
  <div class="grid g3" id="domainOverview"></div>

  <!-- Weak spots -->
  <div class="section-label">Focus Areas (Lowest Scores)</div>
  <div class="card" id="focusAreas">
    <div class="card-title"><span class="dot" style="background:var(--red)"></span>Priority Gaps</div>
    <div id="focusList" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  VIEW 2: EVALUATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-evaluation">
  <div class="page-header">
    <div>
      <div class="page-title">Skill <span>Evaluation</span></div>
      <div class="page-sub">Score each skill ¬∑ Add notes & OKRs ¬∑ Export scorecard</div>
    </div>
    <div style="display:flex;gap:8px;">
      <button class="btn" onclick="saveSnapshot()">üì∏ Save Snapshot</button>
      <button class="btn btn-primary" onclick="exportEvaluationReport()">‚Üì Export Scorecard</button>
    </div>
  </div>

  <!-- Mode & Industry -->
  <div class="card" style="margin-bottom:16px;">
    <div class="card-title"><span class="dot" style="background:var(--accent)"></span>Evaluation Mode</div>
    <div class="mode-pills" id="modePills">
      <button class="mode-pill active" data-mode="growth" onclick="setMode('growth',this)">üìà Growth</button>
      <button class="mode-pill" data-mode="strategy" onclick="setMode('strategy',this)">üéØ Strategy</button>
      <button class="mode-pill" data-mode="research" onclick="setMode('research',this)">üî¨ Research</button>
      <button class="mode-pill" data-mode="pricing" onclick="setMode('pricing',this)">üí∞ Pricing / Monetization</button>
      <button class="mode-pill" data-mode="hiring" onclick="setMode('hiring',this)">üë• Hiring / Team</button>
      <button class="mode-pill" data-mode="launch" onclick="setMode('launch',this)">üöÄ Product Launch</button>
      <button class="mode-pill" data-mode="pivot" onclick="setMode('pivot',this)">üîÑ Business Pivot</button>
      <button class="mode-pill" data-mode="custom" onclick="setMode('custom',this)">‚öôÔ∏è Custom</button>
    </div>
    <div class="section-label" style="margin-top:0">Industry Context</div>
    <div class="industry-pills" id="industryPills">
      <button class="ind-pill active" onclick="setIndustry('ecomm',this)">E-Commerce / Retail</button>
      <button class="ind-pill" onclick="setIndustry('fashion',this)">Fashion / Styling</button>
      <button class="ind-pill" onclick="setIndustry('saas',this)">SaaS / Tech</button>
      <button class="ind-pill" onclick="setIndustry('health',this)">Health / Wellness</button>
      <button class="ind-pill" onclick="setIndustry('finance',this)">Finance / FinTech</button>
      <button class="ind-pill" onclick="setIndustry('marketplace',this)">Marketplace</button>
      <button class="ind-pill" onclick="setIndustry('other',this)">Other / Custom</button>
    </div>
    <div id="modeDescription" style="color:var(--text2); font-size:11px; padding:10px 12px; background:var(--surface2); border-radius:6px; border-left:3px solid var(--accent);">
      Growth mode: weights amplified for conversion, campaign analysis, pricing, and data-driven decision making.
    </div>
  </div>

  <!-- Domain Evaluations -->
  <div id="evaluationDomains"></div>

  <!-- Snapshots -->
  <div class="card" style="margin-top:16px;" id="snapshotsCard">
    <div class="card-title"><span class="dot" style="background:var(--accent3)"></span>Saved Snapshots</div>
    <div id="snapshotsList" style="color:var(--text2);font-size:11px;">No snapshots saved yet. Click "Save Snapshot" to capture your current scores.</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  VIEW 3: FLOW MAP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-flowmap">
  <div class="page-header">
    <div>
      <div class="page-title">Skill <span>Flow Map</span></div>
      <div class="page-sub">Click any node to open detail panel ¬∑ Lines show influence ¬∑ Red = inverse correlation</div>
    </div>
    <button class="btn" onclick="exportFlowNotes()">‚Üì Export Node Notes</button>
  </div>

  <div id="flow-canvas">
    <svg class="flow-svg" id="flowSvg"></svg>
  </div>
  <div style="margin-top:12px; color:var(--text2); font-size:10px; text-align:center;">
    Click any node to open its detail panel ¬∑ Line thickness = correlation strength ¬∑ Red lines = inverse relationship
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  VIEW 4: INITIATIVES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-initiatives">
  <div class="page-header">
    <div>
      <div class="page-title">Initiative <span>Prioritizer</span></div>
      <div class="page-sub">Click any initiative to open its full workspace ¬∑ Owner ¬∑ Budget ¬∑ Risk ¬∑ OKR</div>
    </div>
    <div style="display:flex;gap:8px;">
      <button class="btn" onclick="exportInitiativesReport()">‚Üì Export Report</button>
      <button class="btn btn-primary" onclick="addInitiative()">+ Add Initiative</button>
    </div>
  </div>

  <div class="grid g4" style="margin-bottom:20px;">
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--green)" id="initHigh">0</div>
      <div class="stat-label">HIGH PRIORITY</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--accent3)">‚Äî</div>
      <div class="stat-label">AVG IMPACT SCORE</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--accent2)" id="initTotal">0</div>
      <div class="stat-label">TOTAL INITIATIVES</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--accent4)">Q1</div>
      <div class="stat-label">FOCUS QUARTER</div>
    </div>
  </div>

  <div class="card" style="margin-bottom:16px;">
    <div class="card-title"><span class="dot" style="background:var(--accent2)"></span>Effort √ó Impact Matrix</div>
    <div class="initiative-grid">
      <div class="quadrant q1">
        <div class="q-label" style="color:var(--green)">‚¨° Do Now ‚Äî High Impact, Low Effort</div>
        <div id="q1Items"></div>
      </div>
      <div class="quadrant q2">
        <div class="q-label" style="color:var(--accent3)">‚¨° Plan ‚Äî High Impact, High Effort</div>
        <div id="q2Items"></div>
      </div>
      <div class="quadrant q3">
        <div class="q-label" style="color:var(--amber)">‚¨° Quick Wins ‚Äî Low Impact, Low Effort</div>
        <div id="q3Items"></div>
      </div>
      <div class="quadrant q4">
        <div class="q-label" style="color:var(--red)">‚¨° Deprioritize ‚Äî Low Impact, High Effort</div>
        <div id="q4Items"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--accent4)"></span>All Initiatives ‚Äî Click any row to open full workspace</div>
    <table class="corr-table" style="width:100%">
      <thead>
        <tr>
          <th>Initiative</th>
          <th>Type</th>
          <th>Impact (1-10)</th>
          <th>Effort (1-10)</th>
          <th>Skills Needed</th>
          <th>Priority</th>
          <th>Open</th>
        </tr>
      </thead>
      <tbody id="initTableBody"></tbody>
    </table>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  VIEW 5: TEMPLATES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-templates">
  <div class="page-header">
    <div>
      <div class="page-title">One-Page <span>Templates</span></div>
      <div class="page-sub">Click any template to open ¬∑ Fill in your vision ¬∑ Download individually or all together</div>
    </div>
  </div>
  <div class="dl-all-bar">
    <div class="dl-all-bar-text"><strong>All Templates Bundle</strong> ‚Äî Download every template with your filled data as a single HTML report</div>
    <button class="dl-btn dl-btn-all" onclick="downloadAllTemplates()">‚Üì Download All Templates</button>
  </div>
  <div class="template-grid" id="templateGrid"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  TEMPLATE OVERLAY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay-backdrop" id="templateOverlay" onclick="closeOverlay(event)">
  <div class="overlay-panel" id="overlayPanel">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <span id="overlayIcon" style="font-size:20px"></span>
        <div>
          <div id="overlayTitle" style="font-size:16px"></div>
          <div id="overlaySubtitle" style="font-size:10px;color:var(--text2);font-family:'DM Mono',monospace;font-weight:400;margin-top:2px;"></div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="dl-btn dl-btn-secondary" onclick="downloadSingleTemplate()">‚Üì Download HTML</button>
        <button class="dl-btn dl-btn-primary" onclick="downloadSingleTemplate('print')">üñ® Print / Save PDF</button>
        <button class="overlay-close" onclick="closeOverlayDirect()">‚úï</button>
      </div>
    </div>

    <div class="overlay-body">
      <!-- LEFT: Editable Workspace -->
      <div>
        <div class="overlay-section-title"><span style="color:var(--accent)">‚¨°</span> Your Workspace</div>
        <div style="overflow-x:auto;">
          <table class="ws-table" id="workspaceTable">
            <thead>
              <tr>
                <th>Step</th>
                <th>Your Plan / Vision</th>
                <th>Owner</th>
                <th>Due Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="workspaceTbody"></tbody>
          </table>
        </div>
        <div style="margin-top:16px;">
          <div class="overlay-section-title"><span style="color:var(--accent2)">‚¨°</span> Notes & Context</div>
          <textarea class="ws-notes" id="wsNotes" placeholder="Add your strategic context, assumptions, constraints, or open questions here..."></textarea>
        </div>
        <div style="margin-top:14px;">
          <div class="overlay-section-title"><span style="color:var(--accent3)">‚¨°</span> Key Metrics to Track</div>
          <textarea class="ws-notes" id="wsMetrics" placeholder="e.g. CVR target: 3.5% ¬∑ AOV target: ‚Ç¨65 ¬∑ Timeline: Q2 2026..." style="min-height:56px;"></textarea>
        </div>
      </div>

      <!-- RIGHT: Workflow Steps + Correlations -->
      <div>
        <div class="overlay-section-title"><span style="color:var(--accent4)">‚¨°</span> Workflow Steps</div>
        <div id="overlaySteps" style="margin-bottom:20px;"></div>
        <div class="overlay-section-title"><span style="color:var(--red)">‚¨°</span> Related Correlations</div>
        <div class="corr-mini" id="overlayCorrelations"></div>
      </div>
    </div>

    <div class="overlay-footer">
      <div class="overlay-footer-note">Your notes are saved per template while the page is open ¬∑ Download to keep permanently</div>
      <div class="dl-btns">
        <button class="dl-btn dl-btn-secondary" onclick="clearWorkspace()">‚Ü∫ Clear</button>
        <button class="dl-btn dl-btn-secondary" onclick="downloadSingleTemplate()">‚Üì Download HTML</button>
        <button class="dl-btn dl-btn-primary" onclick="downloadSingleTemplate('print')">üñ® Print / PDF</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  VIEW 6: CORRELATIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-correlations">
  <div class="page-header">
    <div>
      <div class="page-title">Metric <span>Correlations</span></div>
      <div class="page-sub">Add custom correlations ¬∑ Track cross-metric effects ¬∑ Download correlation map</div>
    </div>
    <button class="btn btn-primary" onclick="exportCorrelationsReport()">‚Üì Export Correlation Map</button>
  </div>

  <div class="card" style="margin-bottom:16px;">
    <div class="card-title"><span class="dot" style="background:var(--accent3)"></span>Key Insight: Non-Obvious Correlations</div>
    <div style="color:var(--text2); font-size:12px; line-height:1.8; padding:4px 0;">
      This view captures how metrics that appear unrelated can create <strong style="color:var(--text)">significant indirect effects</strong>. 
      Example: Improving <span style="color:var(--accent)">Conversion Rate</span> by lowering traffic quality can 
      <span style="color:var(--red)">decrease AOV</span> substantially ‚Äî both metrics move, but in opposite directions.
      Use this map before making isolated optimizations.
    </div>
  </div>

  <div class="grid g2" style="margin-bottom:16px;">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent)"></span>Skill ‚Üí Metric Correlations</div>
      <table class="corr-table">
        <thead>
          <tr><th>Skill</th><th>Primary Metric</th><th>Secondary Effect</th><th>Strength</th></tr>
        </thead>
        <tbody id="skillMetricCorr"></tbody>
      </table>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent2)"></span>Metric ‚Üî Metric Influence</div>
      <table class="corr-table">
        <thead>
          <tr><th>Metric A</th><th>‚Üî</th><th>Metric B</th><th>Direction</th><th>Watch For</th></tr>
        </thead>
        <tbody id="metricMetricCorr"></tbody>
      </table>
    </div>
  </div>

  <div class="card" style="margin-bottom:16px;">
    <div class="card-title"><span class="dot" style="background:var(--accent4)"></span>Business Scenario Correlation Alerts</div>
    <div id="corrAlerts" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-top:4px;"></div>
  </div>

  <!-- Custom Correlations -->
  <div class="card">
    <div class="card-title" style="justify-content:space-between;">
      <span><span class="dot" style="background:var(--green)"></span>Your Custom Correlations</span>
      <button class="dl-btn dl-btn-primary" style="padding:5px 14px;font-size:10px;" onclick="addCustomCorrelation()">+ Add Row</button>
    </div>
    <div style="color:var(--text2);font-size:10px;margin-bottom:12px;">Add correlations specific to your business, product, or hypothesis. These will be included in your exported report.</div>
    <table class="corr-table" id="customCorrTable">
      <thead>
        <tr><th>Metric / Skill A</th><th>Metric / Skill B</th><th>Direction</th><th>Strength</th><th>Your Notes</th><th></th></tr>
      </thead>
      <tbody id="customCorrBody"></tbody>
    </table>
    <div id="customCorrEmpty" style="color:var(--text3);font-size:11px;padding:16px 0;text-align:center;">No custom correlations yet ‚Äî click "+ Add Row" to define your own</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  INITIATIVE OVERLAY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay-backdrop" id="initiativeOverlay" onclick="closeInitOverlay(event)">
  <div class="overlay-panel" style="max-width:900px;">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <span style="font-size:18px;margin-right:4px;">‚¨°</span>
        <div>
          <div id="initOverlayTitle" style="font-size:16px;">Initiative Workspace</div>
          <div id="initOverlayMeta" style="font-size:10px;color:var(--text2);font-family:'DM Mono',monospace;margin-top:2px;"></div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="dl-btn dl-btn-secondary" onclick="downloadInitiativeReport()">‚Üì Download Brief</button>
        <button class="dl-btn dl-btn-primary" onclick="downloadInitiativeReport('print')">üñ® Print</button>
        <button class="overlay-close" onclick="closeInitOverlayDirect()">‚úï</button>
      </div>
    </div>
    <div style="padding:24px;display:grid;grid-template-columns:1fr 1fr;gap:20px;">
      <!-- Left -->
      <div>
        <div class="overlay-section-title"><span style="color:var(--accent)">‚¨°</span> Ownership & Timeline</div>
        <table class="ws-table" style="margin-bottom:16px;">
          <thead><tr><th>Field</th><th>Your Input</th></tr></thead>
          <tbody>
            <tr><td>Owner</td><td><input class="ws-cell" id="iw_owner" placeholder="Name or team..." style="min-height:auto;padding:8px;"></td></tr>
            <tr><td>Budget</td><td><input class="ws-cell" id="iw_budget" placeholder="e.g. ‚Ç¨5,000 / Q1..." style="min-height:auto;padding:8px;"></td></tr>
            <tr><td>Start Date</td><td><input class="ws-cell" id="iw_start" placeholder="e.g. March 2026..." style="min-height:auto;padding:8px;"></td></tr>
            <tr><td>Target Date</td><td><input class="ws-cell" id="iw_end" placeholder="e.g. June 2026..." style="min-height:auto;padding:8px;"></td></tr>
            <tr><td>Status</td><td>
              <select class="ws-status" id="iw_status">
                <option>Not Started</option><option>In Progress</option><option>Done</option><option>Blocked</option><option>Paused</option>
              </select>
            </td></tr>
          </tbody>
        </table>

        <div class="overlay-section-title"><span style="color:var(--accent2)">‚¨°</span> Hypothesis & Success Metrics</div>
        <textarea class="ws-notes" id="iw_hypothesis" placeholder="We believe that [initiative] will [outcome] because [reason]. We will know it worked when [metric] reaches [target]..." style="margin-bottom:10px;"></textarea>
        <textarea class="ws-notes" id="iw_metrics" placeholder="Success metrics: e.g. CVR +1.5%, AOV stable above ‚Ç¨60, Churn < 3%..." style="min-height:60px;margin-bottom:10px;"></textarea>

        <div class="overlay-section-title"><span style="color:var(--accent3)">‚¨°</span> OKR / Growth Impact</div>
        <table class="ws-table">
          <thead><tr><th>OKR / Goal</th><th>Expected Impact</th><th>Confidence</th></tr></thead>
          <tbody id="iw_okr_body">
            <tr>
              <td><input class="ws-cell" placeholder="e.g. Increase revenue..." style="min-height:auto;padding:8px;"></td>
              <td><input class="ws-cell" placeholder="e.g. +15% MRR..." style="min-height:auto;padding:8px;"></td>
              <td><select class="ws-status" style="font-size:10px;">
                <option>High (>70%)</option><option>Medium (40-70%)</option><option>Low (<40%)</option>
              </select></td>
            </tr>
          </tbody>
        </table>
        <button class="dl-btn dl-btn-secondary" style="margin-top:8px;font-size:10px;" onclick="addOKRRow()">+ Add OKR Row</button>
      </div>
      <!-- Right -->
      <div>
        <div class="overlay-section-title"><span style="color:var(--red)">‚¨°</span> Risk Register</div>
        <table class="ws-table" style="margin-bottom:16px;" id="iw_risk_table">
          <thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead>
          <tbody id="iw_risks">
            <tr>
              <td><input class="ws-cell" placeholder="e.g. Low adoption..." style="min-height:auto;padding:8px;"></td>
              <td><select class="ws-status" style="font-size:10px;"><option>High</option><option>Medium</option><option>Low</option></select></td>
              <td><input class="ws-cell" placeholder="e.g. Run pilot first..." style="min-height:auto;padding:8px;"></td>
            </tr>
          </tbody>
        </table>
        <button class="dl-btn dl-btn-secondary" style="font-size:10px;" onclick="addRiskRow()">+ Add Risk</button>

        <div class="overlay-section-title" style="margin-top:16px;"><span style="color:var(--accent4)">‚¨°</span> Dependencies</div>
        <textarea class="ws-notes" id="iw_deps" placeholder="e.g. Requires: Engineering sprint in Q2, Legal sign-off on pricing, Design mockups by Mar 15..." style="min-height:70px;margin-bottom:16px;"></textarea>

        <div class="overlay-section-title"><span style="color:var(--accent)">‚¨°</span> Notes & Context</div>
        <textarea class="ws-notes" id="iw_notes" placeholder="Additional context, assumptions, decisions made, stakeholder feedback..."></textarea>
      </div>
    </div>
    <div class="overlay-footer">
      <div class="overlay-footer-note">All fields optional ¬∑ Nothing breaks if left blank ¬∑ Download to save permanently</div>
      <div class="dl-btns">
        <button class="dl-btn dl-btn-secondary" onclick="clearInitWorkspace()">‚Ü∫ Clear</button>
        <button class="dl-btn dl-btn-primary" onclick="downloadInitiativeReport()">‚Üì Download Brief</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  FLOW NODE DETAIL OVERLAY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay-backdrop" id="flowNodeOverlay" onclick="closeFlowOverlay(event)">
  <div class="overlay-panel" style="max-width:600px;">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <div>
          <div id="fnOverlayTitle" style="font-size:16px;"></div>
          <div id="fnOverlaySub" style="font-size:10px;color:var(--text2);font-family:'DM Mono',monospace;margin-top:2px;"></div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="overlay-close" onclick="closeFlowOverlayDirect()">‚úï</button>
      </div>
    </div>
    <div style="padding:20px;">
      <div class="overlay-section-title"><span style="color:var(--accent)">‚¨°</span> Connections</div>
      <div id="fnConnections" style="margin-bottom:16px;"></div>
      <div class="overlay-section-title"><span style="color:var(--accent2)">‚¨°</span> Strategic Notes</div>
      <textarea class="ws-notes" id="fnNotes" placeholder="Add your strategic context for this node ‚Äî what's working, what needs attention, what's the plan..." style="margin-bottom:12px;"></textarea>
      <div class="overlay-section-title"><span style="color:var(--accent3)">‚¨°</span> Current Score</div>
      <div id="fnScoreDisplay" style="font-family:'Syne',sans-serif;font-size:32px;font-weight:800;color:var(--accent);"></div>
    </div>
    <div class="overlay-footer">
      <div class="overlay-footer-note">Notes are saved in memory per node while page is open</div>
      <button class="dl-btn dl-btn-secondary" onclick="closeFlowOverlayDirect()">Close</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  EVALUATION SKILL NOTE OVERLAY  
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="overlay-backdrop" id="skillNoteOverlay" onclick="closeSkillNoteOverlay(event)">
  <div class="overlay-panel" style="max-width:620px;">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <div>
          <div id="snOverlayTitle" style="font-size:15px;"></div>
          <div id="snOverlaySub" style="font-size:10px;color:var(--text2);font-family:'DM Mono',monospace;margin-top:2px;"></div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="overlay-close" onclick="closeSkillNoteOverlayDirect()">‚úï</button>
      </div>
    </div>
    <div style="padding:20px;display:grid;grid-template-columns:1fr 1fr;gap:16px;">
      <div>
        <div class="overlay-section-title"><span style="color:var(--accent)">‚¨°</span> Why this score?</div>
        <textarea class="ws-notes" id="sn_reasoning" placeholder="Explain your reasoning for this score ‚Äî what evidence, experience, or gap led to it..."></textarea>
        <div class="overlay-section-title" style="margin-top:14px;"><span style="color:var(--accent2)">‚¨°</span> How to improve</div>
        <textarea class="ws-notes" id="sn_improve" placeholder="What would take this from current score to 8+? Course, hire, practice, project..."></textarea>
      </div>
      <div>
        <div class="overlay-section-title"><span style="color:var(--accent3)">‚¨°</span> OKR / Growth this skill delivers</div>
        <textarea class="ws-notes" id="sn_okr" placeholder="e.g. Improving this skill will directly support OKR: Increase conversion rate by 20% in Q2..."></textarea>
        <div class="overlay-section-title" style="margin-top:14px;"><span style="color:var(--accent4)">‚¨°</span> Confidence Level</div>
        <select class="ws-status" id="sn_confidence" style="width:100%;margin-bottom:8px;">
          <option>High ‚Äî I'm confident in this score</option>
          <option>Medium ‚Äî I have some uncertainty</option>
          <option>Low ‚Äî I'm estimating / unsure</option>
        </select>
        <div class="overlay-section-title" style="margin-top:12px;"><span style="color:var(--green)">‚¨°</span> Current Score</div>
        <div id="sn_score_display" style="font-family:'Syne',sans-serif;font-size:40px;font-weight:800;line-height:1;"></div>
        <div id="sn_rag_display" style="font-size:11px;margin-top:4px;"></div>
      </div>
    </div>
    <div class="overlay-footer">
      <div class="overlay-footer-note">Notes saved in memory ¬∑ Included in scorecard export</div>
      <div class="dl-btns">
        <button class="dl-btn dl-btn-secondary" onclick="closeSkillNoteOverlayDirect()">Done</button>
        <button class="dl-btn dl-btn-primary" onclick="exportEvaluationReport()">‚Üì Export Scorecard</button>
      </div>
    </div>
  </div>
</div>

<!-- INITIATIVE OVERLAY -->
<div class="overlay-backdrop" id="initiativeOverlay" onclick="if(event.target===this)closeInitOverlay()">
  <div class="overlay-panel">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <span style="font-size:18px;">‚¨°</span>
        <div>
          <div id="initOvTitle" style="font-size:16px;"></div>
          <div id="initOvMeta" style="font-size:10px;color:var(--text2);margin-top:2px;"></div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="dl-btn dl-btn-secondary" onclick="downloadInitBrief()">‚Üì Brief</button>
        <button class="dl-btn dl-btn-primary" onclick="downloadInitBrief('print')">üñ® Print</button>
        <button class="overlay-close" onclick="closeInitOverlay()">‚úï</button>
      </div>
    </div>
    <div class="overlay-body">
      <div>
        <div class="overlay-section-title"><span style="color:var(--accent)">‚¨°</span> Ownership & Timeline</div>
        <table class="ws-table" style="margin-bottom:14px;">
          <thead><tr><th>Field</th><th>Your Input</th></tr></thead>
          <tbody>
            <tr><td style="padding:6px 10px;color:var(--text2);font-size:11px;">Owner</td><td><input class="ws-notes" id="iw_owner" placeholder="Name or team‚Ä¶" style="min-height:auto;padding:8px;"></td></tr>
            <tr><td style="padding:6px 10px;color:var(--text2);font-size:11px;">Budget</td><td><input class="ws-notes" id="iw_budget" placeholder="e.g. ‚Ç¨5,000 / Q1‚Ä¶" style="min-height:auto;padding:8px;"></td></tr>
            <tr><td style="padding:6px 10px;color:var(--text2);font-size:11px;">Start</td><td><input class="ws-notes" id="iw_start" placeholder="e.g. March 2026‚Ä¶" style="min-height:auto;padding:8px;"></td></tr>
            <tr><td style="padding:6px 10px;color:var(--text2);font-size:11px;">Target</td><td><input class="ws-notes" id="iw_end" placeholder="e.g. June 2026‚Ä¶" style="min-height:auto;padding:8px;"></td></tr>
            <tr><td style="padding:6px 10px;color:var(--text2);font-size:11px;">Status</td><td>
              <select class="ws-notes" id="iw_status" style="min-height:auto;padding:6px 8px;">
                <option>Not Started</option><option>In Progress</option><option>Done</option><option>Blocked</option><option>Paused</option>
              </select>
            </td></tr>
          </tbody>
        </table>
        <div class="overlay-section-title"><span style="color:var(--accent2)">‚¨°</span> Hypothesis</div>
        <textarea class="ws-notes" id="iw_hypothesis" placeholder="We believe [initiative] will [outcome] because [reason]. We'll know it worked when [metric] hits [target]‚Ä¶" style="margin-bottom:10px;"></textarea>
        <div class="overlay-section-title"><span style="color:var(--accent3)">‚¨°</span> Success Metrics</div>
        <textarea class="ws-notes" id="iw_metrics" placeholder="e.g. CVR +1.5%, AOV stable >‚Ç¨60, Churn <3%‚Ä¶" style="min-height:56px;margin-bottom:10px;"></textarea>
        <div class="overlay-section-title"><span style="color:var(--accent4)">‚¨°</span> OKR / Growth Impact</div>
        <table class="ws-table">
          <thead><tr><th>OKR / Goal</th><th>Expected Impact</th><th>Confidence</th></tr></thead>
          <tbody id="iw_okr_body">
            <tr>
              <td><input class="ws-notes" placeholder="e.g. Increase revenue‚Ä¶" style="min-height:auto;padding:7px;"></td>
              <td><input class="ws-notes" placeholder="e.g. +15% MRR‚Ä¶" style="min-height:auto;padding:7px;"></td>
              <td><select class="ws-notes" style="min-height:auto;padding:5px;font-size:10px;"><option>High (>70%)</option><option>Medium (40-70%)</option><option>Low (<40%)</option></select></td>
            </tr>
          </tbody>
        </table>
        <button class="dl-btn dl-btn-secondary" style="margin-top:8px;" onclick="addOKRRow()">+ OKR Row</button>
      </div>
      <div>
        <div class="overlay-section-title"><span style="color:var(--red)">‚¨°</span> Risk Register</div>
        <table class="ws-table" style="margin-bottom:8px;">
          <thead><tr><th>Risk</th><th>Impact</th><th>Mitigation</th></tr></thead>
          <tbody id="iw_risks">
            <tr>
              <td><input class="ws-notes" placeholder="e.g. Low adoption‚Ä¶" style="min-height:auto;padding:7px;"></td>
              <td><select class="ws-notes" style="min-height:auto;padding:5px;font-size:10px;"><option>High</option><option>Medium</option><option>Low</option></select></td>
              <td><input class="ws-notes" placeholder="e.g. Run pilot first‚Ä¶" style="min-height:auto;padding:7px;"></td>
            </tr>
          </tbody>
        </table>
        <button class="dl-btn dl-btn-secondary" onclick="addRiskRow()">+ Risk</button>
        <div class="overlay-section-title" style="margin-top:14px;"><span style="color:var(--text2)">‚¨°</span> Dependencies</div>
        <textarea class="ws-notes" id="iw_deps" placeholder="e.g. Engineering sprint Q2, Legal sign-off, Design mockups by Mar 15‚Ä¶" style="min-height:56px;margin-bottom:12px;"></textarea>
        <div class="overlay-section-title"><span style="color:var(--text2)">‚¨°</span> Notes</div>
        <textarea class="ws-notes" id="iw_notes" placeholder="Additional context, decisions made, stakeholder feedback‚Ä¶"></textarea>
      </div>
    </div>
    <div class="overlay-footer">
      <div class="overlay-footer-note">All fields optional ‚Äî nothing breaks if blank</div>
      <div class="dl-btns">
        <button class="dl-btn dl-btn-secondary" onclick="clearInitWs()">‚Ü∫ Clear</button>
        <button class="dl-btn dl-btn-primary" onclick="downloadInitBrief()">‚Üì Brief</button>
      </div>
    </div>
  </div>
</div>

<!-- SKILL NOTE OVERLAY -->
<div class="overlay-backdrop" id="skillNoteOverlay" onclick="if(event.target===this)closeSkillNote()">
  <div class="overlay-panel" style="max-width:620px;">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <div>
          <div id="snTitle" style="font-size:15px;"></div>
          <div style="font-size:10px;color:var(--text2);margin-top:2px;">Add notes, OKR context, confidence</div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="overlay-close" onclick="closeSkillNote()">‚úï</button>
      </div>
    </div>
    <div class="overlay-body">
      <div>
        <div class="overlay-section-title">Why this score?</div>
        <textarea class="ws-notes" id="sn_reasoning" placeholder="Evidence or experience behind this rating‚Ä¶"></textarea>
        <div class="overlay-section-title" style="margin-top:12px;">How to improve</div>
        <textarea class="ws-notes" id="sn_improve" placeholder="What would get this to 8+? Course, hire, project‚Ä¶"></textarea>
      </div>
      <div>
        <div class="overlay-section-title">OKR this skill delivers</div>
        <textarea class="ws-notes" id="sn_okr" placeholder="e.g. Improving this supports OKR: +20% CVR in Q2‚Ä¶" style="margin-bottom:12px;"></textarea>
        <div class="overlay-section-title">Confidence</div>
        <select class="ws-notes" id="sn_confidence" style="min-height:auto;padding:6px 8px;margin-bottom:16px;width:100%;">
          <option>High ‚Äî confident in this score</option>
          <option>Medium ‚Äî some uncertainty</option>
          <option>Low ‚Äî estimating</option>
        </select>
        <div id="sn_score_display" style="font-family:'Syne',sans-serif;font-size:42px;font-weight:800;line-height:1;"></div>
        <div id="sn_rag_display" style="font-size:11px;margin-top:5px;font-weight:600;"></div>
      </div>
    </div>
    <div class="overlay-footer">
      <div class="overlay-footer-note">Notes included in scorecard export</div>
      <div class="dl-btns">
        <button class="dl-btn dl-btn-secondary" onclick="closeSkillNote()">Done</button>
        <button class="dl-btn dl-btn-primary" onclick="exportEvaluationReport()">‚Üì Scorecard</button>
      </div>
    </div>
  </div>
</div>

<!-- FLOW NODE OVERLAY -->
<div class="overlay-backdrop" id="flowNodeOverlay" onclick="if(event.target===this)closeFlowNode()">
  <div class="overlay-panel" style="max-width:540px;">
    <div class="overlay-topbar">
      <div class="overlay-title">
        <div>
          <div id="fnTitle" style="font-size:15px;"></div>
          <div id="fnSub" style="font-size:10px;color:var(--text2);margin-top:2px;"></div>
        </div>
      </div>
      <div class="overlay-actions">
        <button class="overlay-close" onclick="closeFlowNode()">‚úï</button>
      </div>
    </div>
    <div style="padding:20px;">
      <div class="overlay-section-title">Connections</div>
      <div id="fnConnections" style="margin-bottom:16px;"></div>
      <div class="overlay-section-title">Current Score</div>
      <div id="fnScore" style="font-family:'Syne',sans-serif;font-size:36px;font-weight:800;margin-bottom:16px;"></div>
      <div class="overlay-section-title">Strategic Notes</div>
      <textarea class="ws-notes" id="fnNotes" placeholder="What's working, what needs attention, what's the plan‚Ä¶"></textarea>
    </div>
    <div class="overlay-footer">
      <div class="overlay-footer-note">Notes saved per node while page is open</div>
      <button class="dl-btn dl-btn-secondary" onclick="closeFlowNode()">Close</button>
    </div>
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA MODEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const SKILL_DATA = [
  {
    id: 'pm-core', name: 'PM Core', color: '#e8ff47',
    skills: [
      { id: 'strategy', name: 'Strategic Thinking & Roadmapping', desc: 'Vision, prioritization, OKRs, roadmaps' },
      { id: 'user-research', name: 'User Research & Empathy', desc: 'Interviews, personas, journey maps' },
      { id: 'data', name: 'Data Analysis & Metrics', desc: 'KPIs, A/B testing, analytics interpretation' },
      { id: 'writing', name: 'Writing & Communication', desc: 'PRDs, briefs, stakeholder updates' },
      { id: 'collab', name: 'Cross-functional Collaboration', desc: 'Eng, design, GTM alignment' },
      { id: 'problem', name: 'Problem Structuring', desc: 'Ambiguity ‚Üí structured hypotheses' },
    ]
  },
  {
    id: 'research', name: 'Research Skills', color: '#47c4ff',
    skills: [
      { id: 'competitive', name: 'Competitive Analysis', desc: 'Competitor mapping, gap analysis, benchmarking' },
      { id: 'ux-research', name: 'UX / UI Research', desc: 'Usability tests, heatmaps, design sprints' },
      { id: 'market', name: 'Market Research', desc: 'TAM/SAM, trend analysis, customer segmentation' },
      { id: 'campaign', name: 'Campaign Analysis', desc: 'Channel attribution, ROAS, funnel analysis' },
    ]
  },
  {
    id: 'pricing', name: 'Pricing Strategy', color: '#ff6b35',
    skills: [
      { id: 'pricing-models', name: 'Pricing Models', desc: 'Value-based, cost-plus, freemium, subscription' },
      { id: 'pricing-test', name: 'Price Testing & Elasticity', desc: 'A/B tests, willingness-to-pay research' },
      { id: 'monetization', name: 'Monetization Strategy', desc: 'New revenue streams, upsell, cross-sell' },
      { id: 'pivot-pricing', name: 'Model Pivoting', desc: 'Shifting fee structures, new service tiers' },
    ]
  },
  {
    id: 'data-decision', name: 'Data-Based Decision Making', color: '#c47aff',
    skills: [
      { id: 'metrics-design', name: 'Metrics Design', desc: 'North Star, guardrail metrics, leading indicators' },
      { id: 'experimentation', name: 'Experimentation', desc: 'Hypothesis design, statistical significance, multi-variate' },
      { id: 'dashboards', name: 'Dashboards & Reporting', desc: 'BI tools, exec reporting, cohort analysis' },
      { id: 'aov-conv', name: 'Cross-Metric Fluency', desc: 'Conversion‚ÜîAOV, LTV‚ÜîCAC, traffic‚Üîquality tradeoffs' },
    ]
  },
  {
    id: 'growth', name: 'Growth & Campaigns', color: '#44dd88',
    skills: [
      { id: 'growth-loops', name: 'Growth Loops & Funnels', desc: 'Acquisition, activation, retention, referral' },
      { id: 'campaign-mgmt', name: 'Campaign Management', desc: 'Paid, organic, influencer, email orchestration' },
      { id: 'conversion', name: 'Conversion Optimization', desc: 'CRO, landing pages, checkout flows' },
      { id: 'aov', name: 'AOV & Revenue Optimization', desc: 'Basket size, upsell, bundle strategy' },
    ]
  }
];

const MODE_WEIGHTS = {
  growth: { 'pm-core':0.15, 'research':0.15, 'pricing':0.15, 'data-decision':0.25, 'growth':0.30 },
  strategy: { 'pm-core':0.35, 'research':0.25, 'pricing':0.15, 'data-decision':0.15, 'growth':0.10 },
  research: { 'pm-core':0.15, 'research':0.45, 'pricing':0.10, 'data-decision':0.20, 'growth':0.10 },
  pricing: { 'pm-core':0.15, 'research':0.20, 'pricing':0.35, 'data-decision':0.20, 'growth':0.10 },
  hiring: { 'pm-core':0.40, 'research':0.20, 'pricing':0.10, 'data-decision':0.20, 'growth':0.10 },
  launch: { 'pm-core':0.25, 'research':0.20, 'pricing':0.20, 'data-decision':0.15, 'growth':0.20 },
  pivot: { 'pm-core':0.20, 'research':0.20, 'pricing':0.30, 'data-decision':0.20, 'growth':0.10 },
  custom: { 'pm-core':0.20, 'research':0.20, 'pricing':0.20, 'data-decision':0.20, 'growth':0.20 },
};

const MODE_DESC = {
  growth: 'Growth mode: weights amplified for conversion, campaign analysis, pricing, and data-driven decision making.',
  strategy: 'Strategy mode: emphasizes PM core skills, roadmapping, and research depth.',
  research: 'Research mode: heavy weighting on competitive analysis, UX/UI research, and market intelligence.',
  pricing: 'Pricing / Monetization mode: focused on pricing models, elasticity testing, and revenue model pivots.',
  hiring: 'Hiring mode: evaluates against broad PM competency baseline ‚Äî all core skills weighted heavily.',
  launch: 'Product Launch mode: balances GTM, pricing, research, and communication skills.',
  pivot: 'Business Pivot mode: stress-tests ability to reframe pricing, strategy, and market fit from scratch.',
  custom: 'Custom mode: equal weights across all domains ‚Äî adjust domain weights manually below.',
};

// State
let scores = {};
let currentMode = 'growth';
let currentIndustry = 'ecomm';

// Init scores
SKILL_DATA.forEach(d => d.skills.forEach(s => { scores[s.id] = 5; }));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getRag(score) {
  if (score >= 7.5) return 'G';
  if (score >= 5) return 'A';
  return 'R';
}
function getRagColor(rag) {
  if (rag === 'G') return 'var(--green)';
  if (rag === 'A') return 'var(--amber)';
  return 'var(--red)';
}
function getDomainAvg(domain) {
  const vals = domain.skills.map(s => scores[s.id]);
  return vals.reduce((a,b) => a+b,0) / vals.length;
}


function toggleDomain(id) {
  const body = document.getElementById('body_'+id);
  body.style.display = body.style.display === 'none' ? '' : 'none';
}

function setScore(skillId, val) {
  scores[skillId] = parseFloat(val);
  const el = document.getElementById('score_'+skillId);
  const ragEl = document.getElementById('rag_'+skillId);
  if (el) el.textContent = val;
  if (ragEl) { ragEl.textContent = getRag(val); ragEl.className = 'rag-badge rag-'+getRag(val); }
  updateAllDomainBars();
  updateDashboard();
}

function updateAllDomainBars() {
  SKILL_DATA.forEach(domain => {
    const avg = getDomainAvg(domain);
    const bar = document.getElementById('bar_'+domain.id);
    const sc = document.getElementById('domScore_'+domain.id);
    const rd = document.getElementById('domRag_'+domain.id);
    if (bar) bar.style.width = (avg/10*100)+'%';
    if (sc) sc.textContent = avg.toFixed(1);
    if (rd) { rd.style.background = getRagColor(getRag(avg)); }
  });
}

function updateModeWeight(domainId, val) {
  MODE_WEIGHTS[currentMode][domainId] = parseFloat(val)/100;
  updateDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildDomainOverview() {
  const container = document.getElementById('domainOverview');
  container.innerHTML = '';
  SKILL_DATA.forEach((domain, i) => {
    const avg = getDomainAvg(domain);
    const rag = getRag(avg);
    const div = document.createElement('div');
    div.className = 'card';
    div.style.borderColor = domain.color+'30';
    div.style.animationDelay = (i*0.07)+'s';
    div.innerHTML = `
      <div class="card-title"><span class="dot" style="background:${domain.color}"></span>${domain.name.toUpperCase()}</div>
      <div style="font-family:'Syne',sans-serif;font-size:32px;font-weight:800;color:${domain.color};letter-spacing:-2px;">${avg.toFixed(1)}</div>
      <div style="margin:8px 0;">
        <div class="bar-track" style="width:100%;height:6px;border-radius:3px;">
          <div class="bar-fill" style="background:${domain.color};width:${avg/10*100}%"></div>
        </div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <span style="color:var(--text2);font-size:10px;">${domain.skills.length} skills</span>
        <span class="rag-badge rag-${rag}">${rag === 'G' ? '‚óè Green' : rag === 'A' ? '‚óè Amber' : '‚óè Red'}</span>
      </div>
    `;
    div.onclick = () => { showView('evaluation'); };
    container.appendChild(div);
  });
}

function updateDashboard() {
  // Overall
  const allScores = Object.values(scores);
  const overall = allScores.reduce((a,b)=>a+b,0)/allScores.length;
  document.getElementById('overallScore').textContent = overall.toFixed(1);
  const rag = getRag(overall);
  const ragEl = document.getElementById('overallRag');
  ragEl.textContent = rag === 'G' ? '‚óè Green ‚Äî On Track' : rag === 'A' ? '‚óè Amber ‚Äî Developing' : '‚óè Red ‚Äî Critical';
  ragEl.className = 'stat-delta ' + (rag==='G'?'up':rag==='A'?'':' down');
  ragEl.style.color = getRagColor(rag);

  // Green / Red counts
  const greens = allScores.filter(s => getRag(s) === 'G').length;
  const reds = allScores.filter(s => getRag(s) === 'R').length;
  document.getElementById('greenCount').textContent = greens;
  document.getElementById('redCount').textContent = reds;
  document.getElementById('totalSkills').textContent = 'of '+allScores.length+' skills';

  // Mode weighted
  let modeScore = 0;
  SKILL_DATA.forEach(domain => {
    const w = MODE_WEIGHTS[currentMode][domain.id] || 0;
    modeScore += getDomainAvg(domain) * w;
  });
  document.getElementById('modeScoreDisplay').textContent = modeScore.toFixed(1);
  document.getElementById('modeLabel').textContent = currentMode.toUpperCase();

  // Domain overview
  buildDomainOverview();

  // Focus areas
  const sorted = SKILL_DATA.flatMap(d => d.skills.map(s => ({...s, score: scores[s.id], domain: d})))
    .sort((a,b) => a.score - b.score).slice(0,6);
  const focusList = document.getElementById('focusList');
  focusList.innerHTML = sorted.map(s =>
    `<span class="initiative-chip" style="border-color:${getRagColor(getRag(s.score))}40;color:${getRagColor(getRag(s.score))}">
      <span class="rag-dot" style="background:${getRagColor(getRag(s.score))}"></span>
      ${s.name} <strong>${s.score}/10</strong>
    </span>`
  ).join('');

  updateAllDomainBars();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODE & INDUSTRY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setMode(mode, el) {
  currentMode = mode;
  document.querySelectorAll('.mode-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('modeBadge').textContent = '‚¨° '+mode.toUpperCase()+' MODE';
  document.getElementById('modeDescription').textContent = MODE_DESC[mode];
  // Update weight inputs
  SKILL_DATA.forEach(d => {
    const inp = document.getElementById('weight_'+d.id);
    if (inp) inp.value = Math.round(MODE_WEIGHTS[mode][d.id]*100);
  });
  updateDashboard();
}

function setIndustry(ind, el) {
  currentIndustry = ind;
  document.querySelectorAll('.ind-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FLOW MAP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FLOW_NODES = [
  { id:'center', label:'Strategy OS', sub:'Master Score', x:42, y:42, center:true },
  { id:'pm-core', label:'PM Core', sub:'Foundation', x:15, y:15 },
  { id:'research', label:'Research', sub:'Intelligence', x:68, y:12 },
  { id:'pricing', label:'Pricing', sub:'Monetization', x:80, y:42 },
  { id:'data-dec', label:'Data Decisions', sub:'Evidence', x:68, y:72 },
  { id:'growth', label:'Growth', sub:'Scale', x:15, y:72 },
  { id:'conv', label:'Conversion', sub:'CVR metric', x:38, y:78 },
  { id:'aov', label:'AOV', sub:'Revenue / order', x:55, y:78 },
  { id:'traffic', label:'Traffic', sub:'Acquisition', x:20, y:50 },
  { id:'campaign', label:'Campaigns', sub:'Execution', x:70, y:30 },
];

const FLOW_EDGES = [
  { from:'pm-core', to:'center', w:3 },
  { from:'research', to:'center', w:2.5 },
  { from:'pricing', to:'center', w:2 },
  { from:'data-dec', to:'center', w:3 },
  { from:'growth', to:'center', w:2.5 },
  { from:'traffic', to:'conv', w:2, dash:true },
  { from:'conv', to:'aov', w:2.5, inverse:true },
  { from:'campaign', to:'conv', w:1.5 },
  { from:'pricing', to:'aov', w:2 },
  { from:'research', to:'campaign', w:1.5 },
  { from:'growth', to:'conv', w:2 },
  { from:'data-dec', to:'aov', w:1.5 },
];


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIATIVES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEFAULT_INITIATIVES = [
  { name:'Improve Checkout Flow', type:'Product', impact:8, effort:3, skills:['conversion','ux-research'] },
  { name:'Launch Styling Fee Pilot', type:'Pricing', impact:7, effort:6, skills:['pricing-models','pivot-pricing'] },
  { name:'Competitor Deep-Dive', type:'Research', impact:6, effort:2, skills:['competitive','market'] },
  { name:'AOV Upsell Engine', type:'Growth', impact:9, effort:7, skills:['aov','aov-conv'] },
  { name:'New Product Category (e.g. Earbuds)', type:'Strategy', impact:7, effort:9, skills:['strategy','market','pricing-models'] },
  { name:'A/B Test Pricing Page', type:'Pricing', impact:6, effort:3, skills:['pricing-test','experimentation'] },
  { name:'Campaign Attribution Overhaul', type:'Data', impact:8, effort:6, skills:['campaign','dashboards'] },
  { name:'Traffic Quality Audit', type:'Data', impact:7, effort:4, skills:['aov-conv','market'] },
];

let initiatives = [...DEFAULT_INITIATIVES];


function addInitiative() {
  const name = prompt('Initiative name:');
  if (!name) return;
  initiatives.push({ name, type:'Custom', impact:5, effort:5, skills:[] });
  buildInitiatives();
}

function updateInitiative(i, key, val) {
  initiatives[i][key] = parseInt(val);
  buildInitiatives();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TEMPLATES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TEMPLATES = [
  {
    icon:'üéØ', title:'Strategic Roadmapping', color:'#e8ff47',
    steps:[
      { title:'Define North Star', body:'Set 1 primary metric that represents product success. Link to company OKRs.' },
      { title:'Horizon Mapping', body:'Break roadmap into Now / Next / Later. Validate each with user or data evidence.' },
      { title:'Prioritize with RICE', body:'Reach √ó Impact √ó Confidence √∑ Effort. Score top 10 features.' },
      { title:'Stakeholder Alignment', body:'Run roadmap review. Document trade-off decisions with rationale.' },
    ]
  },
  {
    icon:'üî¨', title:'Competitive Analysis', color:'#47c4ff',
    steps:[
      { title:'Define Competitive Set', body:'Direct, indirect, and adjacent competitors. Use Jobs-to-be-Done lens.' },
      { title:'Feature & UX Audit', body:'Score each competitor on 10 dimensions. Use Figma to map UI patterns.' },
      { title:'Gap & Opportunity Matrix', body:'Find what competitors do poorly. Map to your strengths.' },
      { title:'Strategic Response', body:'Where to match, leapfrog, or ignore. Update roadmap accordingly.' },
    ]
  },
  {
    icon:'üñº', title:'UX / UI Research', color:'#c47aff',
    steps:[
      { title:'Research Question', body:'Define 1 clear question. E.g. "Why do users drop off at checkout?"' },
      { title:'Method Selection', body:'Moderated interviews (5 users) or unmoderated tests (20+). Heatmaps optional.' },
      { title:'Synthesis', body:'Affinity map findings. Extract top 3 insight themes.' },
      { title:'Design Recommendations', body:'Map insights to specific UI changes. Prioritize by impact.' },
    ]
  },
  {
    icon:'üí∞', title:'Pricing Strategy', color:'#ff6b35',
    steps:[
      { title:'Value Metric ID', body:'What does your customer pay for? Per user, per feature, per outcome?' },
      { title:'Willingness-to-Pay Research', body:'Survey or Van Westendorp model. Find acceptable price range.' },
      { title:'Competitive Pricing Scan', body:'Map competitor prices. Identify your price position intent.' },
      { title:'Test & Iterate', body:'A/B test pricing pages. Measure conversion and churn impact.' },
    ]
  },
  {
    icon:'üìä', title:'Campaign Analysis', color:'#44dd88',
    steps:[
      { title:'Attribution Model', body:'Define first-touch, last-touch, or multi-touch model. Document in BI tool.' },
      { title:'Channel Performance', body:'ROAS, CPA, CTR per channel. Identify top 20% spend driving 80% return.' },
      { title:'Funnel Drop-Off', body:'Map drop-off from impression ‚Üí conversion. Find the biggest leak.' },
      { title:'Optimization Sprint', body:'3-week sprint: pause bottom quartile, double top quartile, test one new channel.' },
    ]
  },
  {
    icon:'üìà', title:'Data-Based Decisions', color:'#e8ff47',
    steps:[
      { title:'Define the Question', body:'State hypothesis clearly. "We believe X will increase Y by Z%."' },
      { title:'Instrument & Measure', body:'Confirm tracking is in place. Verify data quality before analysis.' },
      { title:'Experiment Design', body:'Set sample size, duration, success metric, and guardrail metric.' },
      { title:'Decision Rule', body:'Define in advance: what result triggers action? Avoid p-hacking.' },
    ]
  },
  {
    icon:'üåç', title:'Market Research', color:'#47c4ff',
    steps:[
      { title:'Market Sizing', body:'Calculate TAM ‚Üí SAM ‚Üí SOM. Use bottoms-up where possible.' },
      { title:'Customer Segmentation', body:'Cluster by needs, not demographics. Use real behavioral data.' },
      { title:'Trend Mapping', body:'Track macro trends (5yr), industry trends (2yr), and signal trends (6mo).' },
      { title:'Insight to Action', body:'Map each insight to a product, pricing, or go-to-market implication.' },
    ]
  },
  {
    icon:'‚ÜîÔ∏è', title:'Conversion ‚Üî AOV Balance', color:'#ff4444',
    steps:[
      { title:'Baseline Both Metrics', body:'Track CVR and AOV simultaneously. Never optimize one in isolation.' },
      { title:'Segment Analysis', body:'Break down by traffic source, device, product category. Find where they diverge.' },
      { title:'Tradeoff Mapping', body:'If CVR ‚Üë and AOV ‚Üì, calculate net revenue impact. Is it worth it?' },
      { title:'Intervention Design', body:'Test bundle offers, minimum spend thresholds, or personalized recommendations.' },
    ]
  },
  {
    icon:'‚≠ê', title:'Evaluation Scorecard', color:'#c47aff',
    steps:[
      { title:'Set Mode & Industry', body:'Choose Evaluation Mode (Growth/Strategy/Research etc.) and Industry context.' },
      { title:'Score Each Skill', body:'Rate 1-10. Use RAG (Red/Amber/Green) for quick status. Be honest.' },
      { title:'Adjust Weights', body:'Set domain weights % to match current business priority or KPI focus.' },
      { title:'Read the Output', body:'Overall score, mode-weighted score, focus areas. Update monthly or per quarter.' },
    ]
  },
];

// Per-template workspace storage (in memory)
const workspaceData = {};
let currentTemplateIndex = null;

// Correlation map per template
const TEMPLATE_CORRELATIONS = {
  0: [ // Strategic Roadmapping
    { title:'Roadmap ‚Üî Resource Allocation', desc:'Roadmap decisions directly affect where engineering and design time goes. Misaligned roadmaps create bottlenecks.', strength:'Strong' },
    { title:'OKRs ‚Üî Feature Prioritization', desc:'Features that don\'t map to OKRs risk being built but not valued. Always trace back to a north star metric.', strength:'Strong' },
    { title:'Strategy clarity ‚Üî Team velocity', desc:'Clear roadmaps reduce re-work and context-switching. Ambiguity costs 20-30% sprint efficiency on average.', strength:'Moderate' },
  ],
  1: [ // Competitive Analysis
    { title:'Competitor pricing ‚Üî Your CVR', desc:'If competitors lower prices, your conversion can drop within days even without changing your own price.', strength:'Strong' },
    { title:'Feature gaps ‚Üî Churn risk', desc:'Unmatched competitor features become churn reasons. Monitor support tickets for competitor mentions.', strength:'Moderate' },
    { title:'Market positioning ‚Üî AOV', desc:'Premium positioning supports higher AOV. Competing on price typically compresses it.', strength:'Strong' },
  ],
  2: [ // UX/UI Research
    { title:'Drop-off rate ‚Üî CVR', desc:'Every 10% reduction in checkout drop-off typically yields 3-6% CVR improvement depending on funnel stage.', strength:'Strong' },
    { title:'UX clarity ‚Üî Support volume', desc:'Poor UX generates support tickets. Fixing navigation confusion can reduce support costs by 15-40%.', strength:'Moderate' },
    { title:'Mobile UX ‚Üî Conversion by device', desc:'Mobile CVR is typically 30-50% lower than desktop. UX research should always segment by device.', strength:'Strong' },
  ],
  3: [ // Pricing Strategy
    { title:'Price point ‚Üî CVR', desc:'Price increases of 10-20% typically reduce CVR by 5-15% depending on elasticity. Always test before rolling out.', strength:'Strong' },
    { title:'Pricing model ‚Üî LTV', desc:'Subscription models generate predictable LTV. One-time purchases have higher CVR but lower lifetime value.', strength:'Strong' },
    { title:'Perceived value ‚Üî AOV', desc:'Adding a fee to a free service shifts perceived value. Customers may assign higher quality but also higher scrutiny.', strength:'Strong' },
  ],
  4: [ // Campaign Analysis
    { title:'Traffic quality ‚Üî CVR', desc:'Broad targeting increases traffic volume but lowers intent quality ‚Äî CVR drops even as click volume rises.', strength:'Strong' },
    { title:'Campaign ROAS ‚Üî AOV', desc:'High-ROAS campaigns often target high-intent, high-spend users. Scaling broadly erodes both ROAS and AOV.', strength:'Strong' },
    { title:'Retargeting ‚Üî Repeat Purchase Rate', desc:'Retargeting campaigns increase repeat purchase rate by 25-50% compared to cold audiences.', strength:'Moderate' },
  ],
  5: [ // Data-Based Decisions
    { title:'CVR ‚Üî AOV (the core tradeoff)', desc:'Optimising for CVR alone ‚Äî e.g. lowering price or simplifying checkout ‚Äî often depresses AOV simultaneously. Always track both.', strength:'Strong' },
    { title:'Sample size ‚Üî Result validity', desc:'Underpowered tests produce false positives. Running an experiment for less than 1-2 weeks typically yields unreliable results.', strength:'Strong' },
    { title:'Guardrail metrics ‚Üî Decision quality', desc:'Without guardrail metrics, you can win on your primary KPI while silently damaging another. Always define what you\'re protecting.', strength:'Strong' },
  ],
  6: [ // Market Research
    { title:'Market size ‚Üî Pricing ceiling', desc:'Niche markets support premium pricing. Commoditised markets compress margins. Know your TAM before setting price strategy.', strength:'Moderate' },
    { title:'Segment behaviour ‚Üî Product roadmap', desc:'Different customer segments have different willingness-to-pay and feature needs. One-size-fits-all roadmaps underserve all segments.', strength:'Strong' },
    { title:'Trend timing ‚Üî First-mover advantage', desc:'Acting on a macro trend 12-18 months early yields 3-5x the advantage vs. acting at peak trend visibility.', strength:'Moderate' },
  ],
  7: [ // Conversion ‚Üî AOV
    { title:'CVR ‚Üî AOV (inverse relationship)', desc:'The most critical cross-metric tradeoff. Lowering barriers to purchase raises CVR but attracts lower-spend customers. Net revenue impact must be modelled.', strength:'Strong' },
    { title:'Traffic source ‚Üî AOV by channel', desc:'Paid social typically drives lower AOV than paid search. Organic brand traffic drives the highest AOV. Channel mix matters.', strength:'Strong' },
    { title:'Discount strategy ‚Üî Repeat purchase AOV', desc:'Heavy discounting trains customers to wait for sales, permanently compressing AOV on repeat purchases.', strength:'Strong' },
  ],
  8: [ // Evaluation Scorecard
    { title:'Skill score ‚Üî Decision confidence', desc:'Low scores in data or pricing directly correlate with higher risk of poor strategic decisions in those areas.', strength:'Strong' },
    { title:'Mode weighting ‚Üî Strategic focus', desc:'The mode you choose determines what skills get amplified. Mismatched modes can make strong teams look weak on paper.', strength:'Moderate' },
    { title:'RAG status ‚Üî Hiring priority', desc:'Red skills that are business-critical become immediate hiring or training priorities. Use the scorecard to justify headcount.', strength:'Strong' },
  ],
};

function buildTemplates() {
  const grid = document.getElementById('templateGrid');
  grid.innerHTML = '';
  TEMPLATES.forEach((t,i) => {
    if (!workspaceData[i]) {
      workspaceData[i] = { rows: t.steps.map(s => ({ plan:'', owner:'', due:'', status:'Not Started' })), notes:'', metrics:'' };
    }
    const filled = workspaceData[i].rows.some(r => r.plan.trim() !== '');
    const div = document.createElement('div');
    div.className = 'template-card';
    div.style.animationDelay = (i*0.06)+'s';
    if (filled) div.style.borderColor = t.color+'60';
    div.innerHTML = `
      <div class="template-header">
        <div class="template-icon" style="background:${t.color}20">${t.icon}</div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px;">${t.title}</div>
          <div style="color:var(--text2);font-size:10px;">${t.steps.length} steps ¬∑ ${filled ? '<span style="color:'+t.color+'">‚óè Workspace filled</span>' : 'Click to open workspace'}</div>
        </div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:6px;">
          ${filled ? `<span style="font-size:9px;color:${t.color};background:${t.color}15;padding:2px 7px;border-radius:4px;border:1px solid ${t.color}30;">FILLED</span>` : ''}
          <div style="width:6px;height:6px;border-radius:50%;background:${t.color}"></div>
        </div>
      </div>
      <div class="template-body">
        ${t.steps.map((s,j) => `
          <div class="template-step">
            <div class="step-num" style="background:${t.color}20;color:${t.color}">${j+1}</div>
            <div class="step-text"><strong>${s.title}</strong>${s.body}</div>
          </div>
        `).join('')}
      </div>
      <div style="padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
        <span style="font-size:10px;color:var(--text2);">Open to fill your vision</span>
        <button class="dl-btn dl-btn-primary" style="padding:5px 14px;font-size:10px;" onclick="event.stopPropagation();openOverlay(${i})">Open Workspace ‚Üí</button>
      </div>
    `;
    div.onclick = () => openOverlay(i);
    grid.appendChild(div);
  });
}

function openOverlay(idx) {
  currentTemplateIndex = idx;
  const t = TEMPLATES[idx];
  const ws = workspaceData[idx];

  // Set header
  document.getElementById('overlayIcon').textContent = t.icon;
  document.getElementById('overlayTitle').textContent = t.title;
  document.getElementById('overlayIcon').style.background = t.color+'20';
  document.getElementById('overlayIcon').style.borderRadius = '8px';
  document.getElementById('overlayIcon').style.padding = '4px 8px';
  document.getElementById('overlaySubtitle').textContent = t.steps.length + ' steps ¬∑ Fill in your plan for each step below';

  // Build workspace table
  const tbody = document.getElementById('workspaceTbody');
  tbody.innerHTML = t.steps.map((s,j) => `
    <tr>
      <td>${j+1}. ${s.title}</td>
      <td><textarea class="ws-cell" rows="2" placeholder="${s.body}" oninput="saveWsRow(${idx},${j},'plan',this.value)">${ws.rows[j]?.plan||''}</textarea></td>
      <td><input class="ws-cell" type="text" placeholder="Name / team" style="min-height:auto;padding:8px;" oninput="saveWsRow(${idx},${j},'owner',this.value)" value="${ws.rows[j]?.owner||''}"></td>
      <td><input class="ws-cell" type="text" placeholder="e.g. Mar 2026" style="min-height:auto;padding:8px;" oninput="saveWsRow(${idx},${j},'due',this.value)" value="${ws.rows[j]?.due||''}"></td>
      <td>
        <select class="ws-status" onchange="saveWsRow(${idx},${j},'status',this.value)" style="color:${getStatusColor(ws.rows[j]?.status||'Not Started')}">
          ${['Not Started','In Progress','Done','Blocked','Deprioritized'].map(st =>
            `<option value="${st}" ${(ws.rows[j]?.status||'Not Started')===st?'selected':''} style="color:${getStatusColor(st)}">${st}</option>`
          ).join('')}
        </select>
      </td>
    </tr>
  `).join('');

  // Notes & metrics
  document.getElementById('wsNotes').value = ws.notes || '';
  document.getElementById('wsMetrics').value = ws.metrics || '';
  document.getElementById('wsNotes').oninput = e => { workspaceData[idx].notes = e.target.value; };
  document.getElementById('wsMetrics').oninput = e => { workspaceData[idx].metrics = e.target.value; };

  // Workflow steps (right panel)
  document.getElementById('overlaySteps').innerHTML = t.steps.map((s,j) => `
    <div style="display:flex;gap:10px;margin-bottom:12px;align-items:flex-start;">
      <div style="width:22px;height:22px;border-radius:50%;background:${t.color}20;color:${t.color};display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;font-family:'Syne',sans-serif;">${j+1}</div>
      <div>
        <div style="font-weight:600;font-size:12px;color:var(--text);margin-bottom:2px;">${s.title}</div>
        <div style="font-size:10px;color:var(--text2);line-height:1.6;">${s.body}</div>
      </div>
    </div>
  `).join('');

  // Correlations (right panel)
  const corrs = TEMPLATE_CORRELATIONS[idx] || [];
  document.getElementById('overlayCorrelations').innerHTML = corrs.map(c => `
    <div class="corr-mini-row">
      <div>
        <span class="corr-chip ${c.strength==='Strong'?'corr-strong':'corr-moderate'}" style="margin-bottom:4px;display:inline-block;">${c.strength}</span>
        <div class="corr-mini-label"><strong>${c.title}</strong>${c.desc}</div>
      </div>
    </div>
  `).join('');

  // Open
  document.getElementById('templateOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function getStatusColor(status) {
  const map = { 'Not Started':'#8888a0', 'In Progress':'#ffaa00', 'Done':'#44dd88', 'Blocked':'#ff4444', 'Deprioritized':'#555568' };
  return map[status] || '#8888a0';
}

function saveWsRow(idx, rowIdx, field, value) {
  if (!workspaceData[idx]) return;
  workspaceData[idx].rows[rowIdx][field] = value;
}

function closeOverlay(event) {
  if (event.target === document.getElementById('templateOverlay')) closeOverlayDirect();
}
function closeOverlayDirect() {
  document.getElementById('templateOverlay').classList.remove('open');
  document.body.style.overflow = '';
  buildTemplates(); // refresh cards to show filled state
}

function clearWorkspace() {
  if (currentTemplateIndex === null) return;
  const t = TEMPLATES[currentTemplateIndex];
  workspaceData[currentTemplateIndex] = {
    rows: t.steps.map(() => ({ plan:'', owner:'', due:'', status:'Not Started' })),
    notes:'', metrics:''
  };
  openOverlay(currentTemplateIndex);
}

function generateTemplateHTML(idx, standalone) {
  const t = TEMPLATES[idx];
  const ws = workspaceData[idx] || { rows: t.steps.map(() => ({})), notes:'', metrics:'' };
  const corrs = TEMPLATE_CORRELATIONS[idx] || [];
  return `
    <div style="margin-bottom:32px;page-break-inside:avoid;">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid ${t.color}40;">
        <span style="font-size:24px;">${t.icon}</span>
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:#f0f0f5;">${t.title}</div>
          <div style="font-size:11px;color:#8888a0;">${t.steps.length} steps ¬∑ PM Strategy OS Template</div>
        </div>
      </div>
      <table style="width:100%;border-collapse:collapse;margin-bottom:16px;">
        <thead>
          <tr style="background:#18181f;">
            <th style="padding:8px 10px;text-align:left;font-size:10px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">STEP</th>
            <th style="padding:8px 10px;text-align:left;font-size:10px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">WORKFLOW GUIDE</th>
            <th style="padding:8px 10px;text-align:left;font-size:10px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">YOUR PLAN</th>
            <th style="padding:8px 10px;text-align:left;font-size:10px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">OWNER</th>
            <th style="padding:8px 10px;text-align:left;font-size:10px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">DUE</th>
            <th style="padding:8px 10px;text-align:left;font-size:10px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">STATUS</th>
          </tr>
        </thead>
        <tbody>
          ${t.steps.map((s,j) => `
            <tr style="border-bottom:1px solid #2a2a3540;">
              <td style="padding:10px;color:${t.color};font-weight:700;font-size:12px;vertical-align:top;white-space:nowrap;">${j+1}. ${s.title}</td>
              <td style="padding:10px;font-size:10px;color:#8888a0;max-width:180px;vertical-align:top;">${s.body}</td>
              <td style="padding:10px;font-size:11px;color:#f0f0f5;vertical-align:top;">${ws.rows[j]?.plan || '<span style="color:#555568;">‚Äî</span>'}</td>
              <td style="padding:10px;font-size:11px;color:#f0f0f5;vertical-align:top;">${ws.rows[j]?.owner || '‚Äî'}</td>
              <td style="padding:10px;font-size:11px;color:#f0f0f5;vertical-align:top;white-space:nowrap;">${ws.rows[j]?.due || '‚Äî'}</td>
              <td style="padding:10px;vertical-align:top;"><span style="padding:2px 8px;border-radius:4px;font-size:9px;font-weight:600;background:${t.color}20;color:${t.color};">${ws.rows[j]?.status || 'Not Started'}</span></td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      ${ws.notes ? `<div style="margin-bottom:10px;"><div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:6px;">NOTES & CONTEXT</div><div style="background:#18181f;border-left:3px solid ${t.color};padding:10px 14px;font-size:11px;color:#f0f0f5;border-radius:0 6px 6px 0;">${ws.notes}</div></div>` : ''}
      ${ws.metrics ? `<div style="margin-bottom:10px;"><div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:6px;">KEY METRICS</div><div style="background:#18181f;border-left:3px solid #47c4ff;padding:10px 14px;font-size:11px;color:#f0f0f5;border-radius:0 6px 6px 0;">${ws.metrics}</div></div>` : ''}
      ${corrs.length ? `
        <div style="margin-top:14px;">
          <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:8px;">RELATED CORRELATIONS</div>
          ${corrs.map(c => `
            <div style="display:flex;gap:10px;margin-bottom:8px;padding:10px;background:#18181f;border-radius:6px;">
              <span style="padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600;background:${c.strength==='Strong'?'rgba(68,221,136,0.15)':'rgba(255,170,0,0.15)'};color:${c.strength==='Strong'?'#44dd88':'#ffaa00'};flex-shrink:0;align-self:flex-start;">${c.strength}</span>
              <div><div style="font-size:11px;font-weight:600;color:#f0f0f5;margin-bottom:3px;">${c.title}</div><div style="font-size:10px;color:#8888a0;">${c.desc}</div></div>
            </div>
          `).join('')}
        </div>
      ` : ''}
    </div>
  `;
}

function downloadSingleTemplate(mode) {
  if (currentTemplateIndex === null) return;
  const t = TEMPLATES[currentTemplateIndex];
  const content = generateTemplateHTML(currentTemplateIndex, true);
  const html = buildDownloadHTML([currentTemplateIndex], `${t.title} ‚Äî PM Strategy OS`);
  if (mode === 'print') {
    const w = window.open('','_blank');
    w.document.write(html);
    w.document.close();
    setTimeout(() => w.print(), 400);
  } else {
    triggerDownload(html, `template-${t.title.toLowerCase().replace(/\s+/g,'-')}-${getDateStr()}.html`);
  }
}

function downloadAllTemplates() {
  const html = buildDownloadHTML(TEMPLATES.map((_,i)=>i), 'All Templates ‚Äî PM Strategy OS');
  triggerDownload(html, `pm-strategy-os-all-templates-${getDateStr()}.html`);
}

function buildDownloadHTML(indices, title) {
  return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>${title}</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  * { box-sizing:border-box; margin:0; padding:0; }
  body { background:#0a0a0f; color:#f0f0f5; font-family:'DM Mono',monospace; font-size:13px; padding:40px; }
  @media print { body { background:#fff; color:#111; padding:20px; } }
  h1 { font-family:'Syne',sans-serif; font-size:22px; font-weight:800; color:#e8ff47; margin-bottom:8px; }
  .meta { color:#8888a0; font-size:10px; margin-bottom:32px; padding-bottom:16px; border-bottom:1px solid #2a2a35; }
</style>
</head>
<body>
<h1>${title}</h1>
<div class="meta">Generated: ${new Date().toLocaleDateString('en-GB', {day:'numeric',month:'long',year:'numeric'})} ¬∑ PM Strategy OS ¬∑ shreyasbaweja.github.io/pm-strategy-os</div>
${indices.map(i => generateTemplateHTML(i)).join('<hr style="border:none;border-top:1px solid #2a2a35;margin:32px 0;">')}
</body></html>`;
}

function triggerDownload(html, filename) {
  const blob = new Blob([html], {type:'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

function getDateStr() {
  return new Date().toISOString().slice(0,10);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CORRELATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildCorrelations() {
  const smRows = [
    ['Competitive Analysis', 'Market Share', 'Pricing confidence ‚Üë', 'Strong'],
    ['Pricing Strategy', 'Revenue per User', 'Conversion Rate ‚Üì risk', 'Strong'],
    ['Campaign Analysis', 'ROAS', 'AOV change (traffic quality)', 'Moderate'],
    ['Conversion Optimization', 'CVR', 'AOV ‚Üì (volume vs value tradeoff)', 'Strong'],
    ['Data-Based Decisions', 'All KPIs', 'Faster iteration velocity', 'Strong'],
    ['UX Research', 'Drop-off Rate', 'Brand perception', 'Moderate'],
    ['Market Research', 'Pricing confidence', 'Feature prioritization', 'Moderate'],
  ];
  document.getElementById('skillMetricCorr').innerHTML = smRows.map(r =>
    `<tr><td style="color:var(--text)">${r[0]}</td><td style="color:var(--accent2)">${r[1]}</td>
     <td style="color:var(--text2);font-size:10px">${r[2]}</td>
     <td><span class="corr-chip ${r[3]==='Strong'?'corr-strong':'corr-moderate'}">${r[3]}</span></td></tr>`
  ).join('');

  const mmRows = [
    ['Conversion Rate (CVR)', '‚Üï', 'AOV', 'Often Inverse', 'Lowering traffic quality ‚Üë CVR but ‚Üì AOV'],
    ['Traffic Volume', '‚Üï', 'CVR', 'Often Inverse', 'Broad targeting lowers intent signals'],
    ['CAC', '‚Üï', 'LTV', 'Should be positive', 'If CAC ‚Üë but LTV flat ‚Üí unsustainable'],
    ['Pricing (‚Üë)', '‚Üï', 'Conversion Rate', 'Often Inverse', 'Price sensitivity varies by segment'],
    ['AOV', '‚Üï', 'Repeat Purchase Rate', 'Often Positive', 'Higher spenders tend to return more'],
    ['Campaign ROAS', '‚Üï', 'Organic Traffic', 'Moderate Positive', 'Paid halo effect on brand search'],
  ];
  document.getElementById('metricMetricCorr').innerHTML = mmRows.map(r =>
    `<tr><td style="color:var(--accent)">${r[0]}</td><td style="color:var(--text2)">${r[1]}</td>
     <td style="color:var(--accent3)">${r[2]}</td>
     <td><span class="corr-chip ${r[3].includes('Inverse')?'corr-inverse':r[3].includes('Positive')?'corr-strong':'corr-moderate'}">${r[3]}</span></td>
     <td style="color:var(--text2);font-size:10px">${r[4]}</td></tr>`
  ).join('');

  const alerts = [
    { title:'CVR ‚Üë but Revenue Flat', desc:'You may be attracting lower AOV customers. Check segment breakdown before celebrating.', color:'var(--amber)' },
    { title:'Styling Fee Introduction', desc:'Adding a fee to a free service creates perceived value shift. Model AOV and churn impact before launch.', color:'var(--red)' },
    { title:'New Category Launch (e.g. Earbuds)', desc:'Adjacent product requires new competitive intel, pricing strategy, and separate campaign tracking to avoid cannibalizing core metrics.', color:'var(--accent3)' },
    { title:'Traffic ‚Üë, CVR ‚Üì', desc:'Likely audience mismatch. Review campaign targeting before scaling spend.', color:'var(--red)' },
    { title:'AOV ‚Üë, Repeat Rate ‚Üì', desc:'Higher price may reduce frequency. Investigate elasticity by segment.', color:'var(--amber)' },
    { title:'CAC ‚Üë + LTV Flat', desc:'Unit economics deteriorating. Pause scaling and improve activation or retention first.', color:'var(--red)' },
  ];
  document.getElementById('corrAlerts').innerHTML = alerts.map(a => `
    <div style="background:var(--surface2);border:1px solid ${a.color}30;border-left:3px solid ${a.color};border-radius:6px;padding:14px;">
      <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:11px;color:${a.color};margin-bottom:6px;">${a.title}</div>
      <div style="font-size:10px;color:var(--text2);line-height:1.6;">${a.desc}</div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('view-'+id).classList.add('active');
  const tabs = { dashboard:0, evaluation:1, flowmap:2, initiatives:3, templates:4, correlations:5 };
  const tabEls = document.querySelectorAll('.nav-tab');
  if (tabEls[tabs[id]]) tabEls[tabs[id]].classList.add('active');
  if (id === 'flowmap') setTimeout(buildFlowMap, 50);
  if (id === 'dashboard') updateDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportData() {
  const data = {
    mode: currentMode,
    industry: currentIndustry,
    scores,
    weights: MODE_WEIGHTS[currentMode],
    exported: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'pm-os-evaluation.json';
  a.click();
}

function recalcAll() {
  updateDashboard();
  buildFlowMap();
  buildInitiatives();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.onload = function() {
  buildEvaluation();
  buildDomainOverview();
  updateDashboard();
  buildInitiatives();
  buildTemplates();
  buildCorrelations();
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIATIVE OVERLAY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentInitiativeIndex = null;
const initiativeWorkspaces = {};

function openInitiativeOverlay(idx) {
  currentInitiativeIndex = idx;
  const init = initiatives[idx];
  const ws = initiativeWorkspaces[idx] || {};

  document.getElementById('initOverlayTitle').textContent = init.name;
  document.getElementById('initOverlayMeta').textContent =
    `${init.type} ¬∑ Impact ${init.impact}/10 ¬∑ Effort ${init.effort}/10 ¬∑ Skills: ${(init.skills||[]).join(', ')||'‚Äî'}`;

  // Restore saved values
  ['owner','budget','start','end','hypothesis','metrics','deps','notes'].forEach(f => {
    const el = document.getElementById('iw_'+f);
    if (el) el.value = ws[f] || '';
  });
  const statusEl = document.getElementById('iw_status');
  if (statusEl) statusEl.value = ws.status || 'Not Started';

  // OKR rows
  const okrBody = document.getElementById('iw_okr_body');
  okrBody.innerHTML = (ws.okrs || [{ goal:'', impact:'', confidence:'High (>70%)' }]).map(o => `
    <tr>
      <td><input class="ws-cell" value="${o.goal||''}" placeholder="e.g. Increase revenue..." style="min-height:auto;padding:8px;" onchange="saveInitWs(${idx},'okrs')"></td>
      <td><input class="ws-cell" value="${o.impact||''}" placeholder="e.g. +15% MRR..." style="min-height:auto;padding:8px;" onchange="saveInitWs(${idx},'okrs')"></td>
      <td><select class="ws-status" style="font-size:10px;" onchange="saveInitWs(${idx},'okrs')">
        ${['High (>70%)','Medium (40-70%)','Low (<40%)'].map(c=>`<option ${o.confidence===c?'selected':''}>${c}</option>`).join('')}
      </select></td>
    </tr>`).join('');

  // Risk rows
  const riskBody = document.getElementById('iw_risks');
  riskBody.innerHTML = (ws.risks || [{ risk:'', impact:'High', mitigation:'' }]).map(r => `
    <tr>
      <td><input class="ws-cell" value="${r.risk||''}" placeholder="e.g. Low adoption..." style="min-height:auto;padding:8px;" onchange="saveInitWs(${idx},'risks')"></td>
      <td><select class="ws-status" style="font-size:10px;" onchange="saveInitWs(${idx},'risks')">
        ${['High','Medium','Low'].map(c=>`<option ${r.impact===c?'selected':''}>${c}</option>`).join('')}
      </select></td>
      <td><input class="ws-cell" value="${r.mitigation||''}" placeholder="e.g. Run pilot first..." style="min-height:auto;padding:8px;" onchange="saveInitWs(${idx},'risks')"></td>
    </tr>`).join('');

  // Auto-save listeners
  ['owner','budget','start','end','hypothesis','metrics','deps','notes'].forEach(f => {
    const el = document.getElementById('iw_'+f);
    if (el) el.oninput = () => saveInitWsField(idx, f, el.value);
  });
  statusEl.onchange = () => saveInitWsField(idx, 'status', statusEl.value);

  document.getElementById('initiativeOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function saveInitWsField(idx, field, value) {
  if (!initiativeWorkspaces[idx]) initiativeWorkspaces[idx] = {};
  initiativeWorkspaces[idx][field] = value;
}

function saveInitWs(idx, field) {
  if (!initiativeWorkspaces[idx]) initiativeWorkspaces[idx] = {};
  if (field === 'okrs') {
    const rows = document.getElementById('iw_okr_body').querySelectorAll('tr');
    initiativeWorkspaces[idx].okrs = Array.from(rows).map(r => {
      const inputs = r.querySelectorAll('input,select');
      return { goal: inputs[0]?.value||'', impact: inputs[1]?.value||'', confidence: inputs[2]?.value||'' };
    });
  }
  if (field === 'risks') {
    const rows = document.getElementById('iw_risks').querySelectorAll('tr');
    initiativeWorkspaces[idx].risks = Array.from(rows).map(r => {
      const inputs = r.querySelectorAll('input,select');
      return { risk: inputs[0]?.value||'', impact: inputs[1]?.value||'', mitigation: inputs[2]?.value||'' };
    });
  }
}

function addOKRRow() {
  const tbody = document.getElementById('iw_okr_body');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="ws-cell" placeholder="e.g. Increase revenue..." style="min-height:auto;padding:8px;"></td>
    <td><input class="ws-cell" placeholder="e.g. +15% MRR..." style="min-height:auto;padding:8px;"></td>
    <td><select class="ws-status" style="font-size:10px;"><option>High (>70%)</option><option>Medium (40-70%)</option><option>Low (<40%)</option></select></td>`;
  tbody.appendChild(tr);
}

function addRiskRow() {
  const tbody = document.getElementById('iw_risks');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="ws-cell" placeholder="Risk description..." style="min-height:auto;padding:8px;"></td>
    <td><select class="ws-status" style="font-size:10px;"><option>High</option><option>Medium</option><option>Low</option></select></td>
    <td><input class="ws-cell" placeholder="Mitigation plan..." style="min-height:auto;padding:8px;"></td>`;
  tbody.appendChild(tr);
}

function clearInitWorkspace() {
  if (currentInitiativeIndex !== null) {
    initiativeWorkspaces[currentInitiativeIndex] = {};
    openInitiativeOverlay(currentInitiativeIndex);
  }
}

function closeInitOverlay(event) {
  if (event.target === document.getElementById('initiativeOverlay')) closeInitOverlayDirect();
}
function closeInitOverlayDirect() {
  document.getElementById('initiativeOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function downloadInitiativeReport(mode) {
  if (currentInitiativeIndex === null) return;
  const init = initiatives[currentInitiativeIndex];
  const ws = initiativeWorkspaces[currentInitiativeIndex] || {};
  const g = id => document.getElementById(id)?.value || ws[id.replace('iw_','')] || '';

  const html = buildReportHTML(`Initiative Brief: ${init.name}`, `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
      <div>
        <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:8px;">OVERVIEW</div>
        ${[['Type',init.type],['Impact',init.impact+'/10'],['Effort',init.effort+'/10'],
           ['Owner',g('iw_owner')],['Budget',g('iw_budget')],
           ['Start',g('iw_start')],['Target',g('iw_end')],['Status',g('iw_status')]
          ].map(([k,v])=>v?`<div style="display:flex;gap:8px;margin-bottom:6px;font-size:11px;"><span style="color:#8888a0;min-width:80px;">${k}</span><span style="color:#f0f0f5;">${v}</span></div>`:'').join('')}
      </div>
      <div>
        ${g('iw_hypothesis')?`<div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:8px;">HYPOTHESIS</div><div style="background:#18181f;border-left:3px solid #e8ff47;padding:10px 14px;font-size:11px;color:#f0f0f5;border-radius:0 6px 6px 0;margin-bottom:12px;">${g('iw_hypothesis')}</div>`:''}
        ${g('iw_metrics')?`<div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:8px;">SUCCESS METRICS</div><div style="background:#18181f;border-left:3px solid #47c4ff;padding:10px 14px;font-size:11px;color:#f0f0f5;border-radius:0 6px 6px 0;">${g('iw_metrics')}</div>`:''}
      </div>
    </div>
    ${g('iw_deps')?`<div style="margin-bottom:16px;"><div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:8px;">DEPENDENCIES</div><div style="background:#18181f;border-left:3px solid #c47aff;padding:10px 14px;font-size:11px;color:#f0f0f5;border-radius:0 6px 6px 0;">${g('iw_deps')}</div></div>`:''}
    ${g('iw_notes')?`<div><div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:8px;">NOTES</div><div style="background:#18181f;padding:10px 14px;font-size:11px;color:#f0f0f5;border-radius:6px;">${g('iw_notes')}</div></div>`:''}
  `);
  if (mode === 'print') { const w=window.open('','_blank'); w.document.write(html); w.document.close(); setTimeout(()=>w.print(),400); }
  else triggerDownload(html, `initiative-${init.name.toLowerCase().replace(/\s+/g,'-')}-${getDateStr()}.html`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SKILL NOTE OVERLAY (Evaluation)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentSkillId = null;
const skillNotes = {};

function openSkillNote(skillId, skillName, domainColor) {
  currentSkillId = skillId;
  const sn = skillNotes[skillId] || {};
  const score = scores[skillId] || 5;
  const rag = getRag(score);

  document.getElementById('snOverlayTitle').textContent = skillName;
  document.getElementById('snOverlaySub').textContent = 'Add notes, OKR context, and confidence level for this skill';
  document.getElementById('sn_reasoning').value = sn.reasoning || '';
  document.getElementById('sn_improve').value = sn.improve || '';
  document.getElementById('sn_okr').value = sn.okr || '';
  document.getElementById('sn_confidence').value = sn.confidence || 'High ‚Äî I\'m confident in this score';
  document.getElementById('sn_score_display').textContent = score+'/10';
  document.getElementById('sn_score_display').style.color = domainColor || 'var(--accent)';
  document.getElementById('sn_rag_display').textContent = rag==='G'?'‚óè Green ‚Äî Strong':rag==='A'?'‚óè Amber ‚Äî Developing':'‚óè Red ‚Äî Critical gap';
  document.getElementById('sn_rag_display').style.color = getRagColor(rag);

  ['reasoning','improve','okr'].forEach(f => {
    const el = document.getElementById('sn_'+f);
    el.oninput = () => { if(!skillNotes[skillId]) skillNotes[skillId]={}; skillNotes[skillId][f]=el.value; };
  });
  document.getElementById('sn_confidence').onchange = e => {
    if(!skillNotes[skillId]) skillNotes[skillId]={};
    skillNotes[skillId].confidence = e.target.value;
  };

  document.getElementById('skillNoteOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeSkillNoteOverlay(event) {
  if (event.target === document.getElementById('skillNoteOverlay')) closeSkillNoteOverlayDirect();
}
function closeSkillNoteOverlayDirect() {
  document.getElementById('skillNoteOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FLOW NODE OVERLAY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const flowNodeNotes = {};

const FLOW_NODE_INFO = {
  center: { label:'Strategy OS', sub:'Overall PM score across all domains', influences:['All domains'], influencedBy:['All domains'] },
  'pm-core': { label:'PM Core', sub:'Foundation skills: strategy, research, data, comms', influences:['center','conv'], influencedBy:[] },
  research: { label:'Research', sub:'Competitive, UX, market, campaign intelligence', influences:['center','campaign'], influencedBy:[] },
  pricing: { label:'Pricing', sub:'Pricing models, elasticity, monetization pivots', influences:['center','aov'], influencedBy:['research'] },
  'data-dec': { label:'Data Decisions', sub:'Metrics design, experimentation, dashboards', influences:['center','aov'], influencedBy:[] },
  growth: { label:'Growth', sub:'Growth loops, campaign management, CRO', influences:['center','conv'], influencedBy:['research'] },
  conv: { label:'Conversion (CVR)', sub:'Core conversion rate metric', influences:['aov'], influencedBy:['traffic','campaign','growth','pm-core'] },
  aov: { label:'AOV', sub:'Average order value', influences:[], influencedBy:['pricing','data-dec','conv'] },
  traffic: { label:'Traffic', sub:'Acquisition volume and quality', influences:['conv'], influencedBy:['campaign'] },
  campaign: { label:'Campaigns', sub:'Paid, organic, influencer execution', influences:['conv','traffic'], influencedBy:['research'] },
};

function openFlowNode(nodeId) {
  const info = FLOW_NODE_INFO[nodeId];
  if (!info) return;
  document.getElementById('fnOverlayTitle').textContent = info.label;
  document.getElementById('fnOverlaySub').textContent = info.sub;

  // Score display
  const domainMap = { 'pm-core':'pm-core', research:'research', pricing:'pricing', 'data-dec':'data-decision', growth:'growth' };
  let scoreHtml = '';
  if (domainMap[nodeId]) {
    const domain = SKILL_DATA.find(d => d.id === domainMap[nodeId]);
    if (domain) {
      const avg = getDomainAvg(domain);
      const rag = getRag(avg);
      document.getElementById('fnScoreDisplay').textContent = avg.toFixed(1)+'/10';
      document.getElementById('fnScoreDisplay').style.color = domain.color;
      scoreHtml = `<span class="rag-badge rag-${rag}" style="font-size:11px;padding:3px 10px;">${rag==='G'?'‚óè Green':rag==='A'?'‚óè Amber':'‚óè Red'}</span>`;
    }
  } else {
    document.getElementById('fnScoreDisplay').textContent = '‚Äî';
    document.getElementById('fnScoreDisplay').style.color = 'var(--text2)';
  }

  // Connections
  const connHtml = `
    ${info.influences.length?`<div style="margin-bottom:10px;"><div style="font-size:9px;color:var(--text2);letter-spacing:1px;margin-bottom:6px;">INFLUENCES ‚Üí</div>
    ${info.influences.map(n=>`<span class="initiative-chip" style="color:var(--accent);border-color:var(--accent)40">${FLOW_NODE_INFO[n]?.label||n}</span>`).join('')}</div>`:''}
    ${info.influencedBy.length?`<div><div style="font-size:9px;color:var(--text2);letter-spacing:1px;margin-bottom:6px;">‚Üê INFLUENCED BY</div>
    ${info.influencedBy.map(n=>`<span class="initiative-chip" style="color:var(--accent3);border-color:var(--accent3)40">${FLOW_NODE_INFO[n]?.label||n}</span>`).join('')}</div>`:''}
  `;
  document.getElementById('fnConnections').innerHTML = connHtml || '<span style="color:var(--text3);font-size:11px;">No mapped connections</span>';

  // Notes
  const notesEl = document.getElementById('fnNotes');
  notesEl.value = flowNodeNotes[nodeId] || '';
  notesEl.oninput = () => { flowNodeNotes[nodeId] = notesEl.value; };

  document.getElementById('flowNodeOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeFlowOverlay(event) {
  if (event.target === document.getElementById('flowNodeOverlay')) closeFlowOverlayDirect();
}
function closeFlowOverlayDirect() {
  document.getElementById('flowNodeOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function exportFlowNotes() {
  const hasNotes = Object.values(flowNodeNotes).some(n => n.trim());
  if (!hasNotes) { alert('Add notes to flow map nodes first by clicking on them.'); return; }
  const html = buildReportHTML('Flow Map Node Notes', `
    ${Object.entries(flowNodeNotes).filter(([,v])=>v.trim()).map(([id,note]) => {
      const info = FLOW_NODE_INFO[id] || { label:id, sub:'' };
      return `<div style="margin-bottom:16px;padding:14px;background:#18181f;border-radius:8px;border-left:3px solid #e8ff47;">
        <div style="font-family:'Syne',sans-serif;font-weight:700;color:#f0f0f5;margin-bottom:4px;">${info.label}</div>
        <div style="font-size:10px;color:#8888a0;margin-bottom:8px;">${info.sub}</div>
        <div style="font-size:11px;color:#f0f0f5;">${note}</div>
      </div>`;
    }).join('')}
  `);
  triggerDownload(html, `flow-map-notes-${getDateStr()}.html`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SNAPSHOTS (Evaluation)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const snapshots = [];

function saveSnapshot() {
  const name = prompt('Name this snapshot (e.g. "Feb 2026 baseline"):');
  if (!name) return;
  snapshots.push({
    name,
    date: new Date().toLocaleDateString('en-GB'),
    mode: currentMode,
    scores: {...scores},
    overall: (Object.values(scores).reduce((a,b)=>a+b,0)/Object.values(scores).length).toFixed(1)
  });
  renderSnapshots();
}

function renderSnapshots() {
  const container = document.getElementById('snapshotsList');
  if (!snapshots.length) {
    container.innerHTML = '<span style="color:var(--text2);font-size:11px;">No snapshots saved yet.</span>';
    return;
  }
  container.innerHTML = snapshots.map((s,i) => `
    <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--surface2);border-radius:6px;margin-bottom:8px;border:1px solid var(--border);">
      <div>
        <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:13px;">${s.name}</div>
        <div style="color:var(--text2);font-size:10px;">${s.date} ¬∑ ${s.mode.toUpperCase()} mode ¬∑ Overall: ${s.overall}/10</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <span style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--accent)">${s.overall}</span>
        <button class="dl-btn dl-btn-secondary" style="font-size:10px;" onclick="restoreSnapshot(${i})">Restore</button>
        <button class="dl-btn dl-btn-secondary" style="font-size:10px;" onclick="snapshots.splice(${i},1);renderSnapshots()">‚úï</button>
      </div>
    </div>
  `).join('');
}

function restoreSnapshot(i) {
  if (!confirm('Restore this snapshot? Your current scores will be replaced.')) return;
  Object.assign(scores, snapshots[i].scores);
  buildEvaluation();
  updateDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CUSTOM CORRELATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const customCorrelations = [];

function addCustomCorrelation() {
  customCorrelations.push({ a:'', b:'', direction:'Positive', strength:'Moderate', notes:'' });
  renderCustomCorrelations();
}

function renderCustomCorrelations() {
  const tbody = document.getElementById('customCorrBody');
  const empty = document.getElementById('customCorrEmpty');
  if (!customCorrelations.length) {
    tbody.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';
  tbody.innerHTML = customCorrelations.map((c,i) => `
    <tr>
      <td><input class="ws-cell" value="${c.a}" placeholder="Metric or Skill A..." style="min-height:auto;padding:7px;" oninput="customCorrelations[${i}].a=this.value"></td>
      <td><input class="ws-cell" value="${c.b}" placeholder="Metric or Skill B..." style="min-height:auto;padding:7px;" oninput="customCorrelations[${i}].b=this.value"></td>
      <td><select class="ws-status" onchange="customCorrelations[${i}].direction=this.value">
        ${['Positive','Inverse','Neutral','Conditional'].map(d=>`<option ${c.direction===d?'selected':''}>${d}</option>`).join('')}
      </select></td>
      <td><select class="ws-status" onchange="customCorrelations[${i}].strength=this.value">
        ${['Strong','Moderate','Weak'].map(s=>`<option ${c.strength===s?'selected':''}>${s}</option>`).join('')}
      </select></td>
      <td><input class="ws-cell" value="${c.notes}" placeholder="Your observation..." style="min-height:auto;padding:7px;" oninput="customCorrelations[${i}].notes=this.value"></td>
      <td><button onclick="customCorrelations.splice(${i},1);renderCustomCorrelations()" style="background:none;border:none;color:var(--red);cursor:pointer;padding:4px 8px;font-size:14px;">‚úï</button></td>
    </tr>
  `).join('');
}

function exportCorrelationsReport() {
  const html = buildReportHTML('Correlation Map', `
    <h2 style="font-family:'Syne',sans-serif;font-size:16px;font-weight:700;color:#e8ff47;margin-bottom:12px;">Skill ‚Üí Metric Correlations</h2>
    <table style="width:100%;border-collapse:collapse;margin-bottom:24px;">
      <thead><tr>
        ${['Skill','Primary Metric','Secondary Effect','Strength'].map(h=>`<th style="padding:8px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">${h}</th>`).join('')}
      </tr></thead>
      <tbody>
        ${[['Competitive Analysis','Market Share','Pricing confidence ‚Üë','Strong'],
           ['Pricing Strategy','Revenue per User','Conversion Rate ‚Üì risk','Strong'],
           ['Campaign Analysis','ROAS','AOV change (traffic quality)','Moderate'],
           ['Conversion Optimization','CVR','AOV ‚Üì (volume vs value tradeoff)','Strong'],
           ['Data-Based Decisions','All KPIs','Faster iteration velocity','Strong'],
           ['UX Research','Drop-off Rate','Brand perception','Moderate'],
           ['Market Research','Pricing confidence','Feature prioritization','Moderate'],
          ].map(r=>`<tr>${r.map((c,ci)=>`<td style="padding:9px 10px;font-size:11px;color:${ci===0?'#f0f0f5':ci===1?'#ff6b35':'#8888a0'};border-bottom:1px solid #2a2a3530;">${c}</td>`).join('')}</tr>`).join('')}
      </tbody>
    </table>
    ${customCorrelations.length?`
    <h2 style="font-family:'Syne',sans-serif;font-size:16px;font-weight:700;color:#44dd88;margin-bottom:12px;">Your Custom Correlations</h2>
    <table style="width:100%;border-collapse:collapse;">
      <thead><tr>
        ${['Metric A','Metric B','Direction','Strength','Notes'].map(h=>`<th style="padding:8px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">${h}</th>`).join('')}
      </tr></thead>
      <tbody>
        ${customCorrelations.map(c=>`<tr>
          <td style="padding:9px 10px;font-size:11px;color:#e8ff47;border-bottom:1px solid #2a2a3530;">${c.a||'‚Äî'}</td>
          <td style="padding:9px 10px;font-size:11px;color:#47c4ff;border-bottom:1px solid #2a2a3530;">${c.b||'‚Äî'}</td>
          <td style="padding:9px 10px;font-size:11px;border-bottom:1px solid #2a2a3530;">${c.direction}</td>
          <td style="padding:9px 10px;font-size:11px;border-bottom:1px solid #2a2a3530;">${c.strength}</td>
          <td style="padding:9px 10px;font-size:11px;color:#8888a0;border-bottom:1px solid #2a2a3530;">${c.notes||'‚Äî'}</td>
        </tr>`).join('')}
      </tbody>
    </table>` : ''}
  `);
  triggerDownload(html, `correlation-map-${getDateStr()}.html`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVALUATION EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportEvaluationReport() {
  const overall = (Object.values(scores).reduce((a,b)=>a+b,0)/Object.values(scores).length).toFixed(1);
  const html = buildReportHTML(`Evaluation Scorecard ‚Äî ${currentMode.toUpperCase()} Mode`, `
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:24px;">
      <div style="background:#18181f;border-radius:8px;padding:16px;border:1px solid #2a2a35;">
        <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:6px;">OVERALL SCORE</div>
        <div style="font-family:'Syne',sans-serif;font-size:36px;font-weight:800;color:#e8ff47;letter-spacing:-2px;">${overall}</div>
        <div style="font-size:10px;color:${getRagColor(getRag(parseFloat(overall)))}">${getRag(parseFloat(overall))==="G"?"‚óè Green ‚Äî Strong":getRag(parseFloat(overall))==="A"?"‚óè Amber ‚Äî Developing":"‚óè Red ‚Äî Critical"}</div>
      </div>
      <div style="background:#18181f;border-radius:8px;padding:16px;border:1px solid #2a2a35;">
        <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:6px;">MODE</div>
        <div style="font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:#47c4ff;">${currentMode.toUpperCase()}</div>
        <div style="font-size:10px;color:#8888a0;">${currentIndustry.toUpperCase()}</div>
      </div>
      <div style="background:#18181f;border-radius:8px;padding:16px;border:1px solid #2a2a35;">
        <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:6px;">DATE</div>
        <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:#f0f0f5;">${new Date().toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}</div>
      </div>
    </div>
    ${SKILL_DATA.map(domain => `
      <div style="margin-bottom:20px;">
        <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:${domain.color};margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid ${domain.color}30;">${domain.name}</div>
        <table style="width:100%;border-collapse:collapse;">
          <thead><tr>
            <th style="padding:7px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">Skill</th>
            <th style="padding:7px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">Score</th>
            <th style="padding:7px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">Status</th>
            <th style="padding:7px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">OKR</th>
            <th style="padding:7px 10px;text-align:left;font-size:9px;letter-spacing:1px;color:#8888a0;border-bottom:1px solid #2a2a35;">Notes</th>
          </tr></thead>
          <tbody>
            ${domain.skills.map(skill => {
              const sn = skillNotes[skill.id] || {};
              const rag = getRag(scores[skill.id]);
              return `<tr>
                <td style="padding:9px 10px;font-size:11px;color:#f0f0f5;border-bottom:1px solid #2a2a3530;">${skill.name}</td>
                <td style="padding:9px 10px;font-size:13px;font-weight:700;color:${domain.color};border-bottom:1px solid #2a2a3530;">${scores[skill.id]}/10</td>
                <td style="padding:9px 10px;border-bottom:1px solid #2a2a3530;"><span style="padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600;background:${rag==='G'?'rgba(68,221,136,0.15)':rag==='A'?'rgba(255,170,0,0.15)':'rgba(255,68,68,0.15)'};color:${rag==='G'?'#44dd88':rag==='A'?'#ffaa00':'#ff4444'};">${rag==='G'?'Green':rag==='A'?'Amber':'Red'}</span></td>
                <td style="padding:9px 10px;font-size:10px;color:#8888a0;border-bottom:1px solid #2a2a3530;">${sn.okr||'‚Äî'}</td>
                <td style="padding:9px 10px;font-size:10px;color:#8888a0;border-bottom:1px solid #2a2a3530;">${sn.reasoning||'‚Äî'}</td>
              </tr>`;
            }).join('')}
          </tbody>
        </table>
      </div>
    `).join('')}
  `);
  const w = window.open('','_blank');
  w.document.write(html);
  w.document.close();
  setTimeout(() => w.print(), 400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXECUTIVE SUMMARY (Dashboard)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportExecutiveSummary() {
  const overall = (Object.values(scores).reduce((a,b)=>a+b,0)/Object.values(scores).length).toFixed(1);
  let modeScore = 0;
  SKILL_DATA.forEach(d => { modeScore += getDomainAvg(d) * (MODE_WEIGHTS[currentMode][d.id]||0); });

  const sorted = SKILL_DATA.flatMap(d => d.skills.map(s => ({...s, score: scores[s.id], domain:d})))
    .sort((a,b) => a.score - b.score);
  const gaps = sorted.slice(0,4);
  const strengths = sorted.slice(-4).reverse();
  const highInit = initiatives.filter(i => { const h=i.impact>=6; const e=i.effort<6; return h&&e; });

  const html = buildReportHTML('Executive Strategy Summary', `
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px;">
      ${[['Overall Score',overall+'/10','#e8ff47'],['Mode',currentMode.toUpperCase(),'#47c4ff'],
         ['Mode Score',modeScore.toFixed(1)+'/10','#c47aff'],['Do-Now Initiatives',highInit.length+' items','#44dd88']
        ].map(([l,v,c])=>`<div style="background:#18181f;border-radius:8px;padding:14px;border:1px solid #2a2a35;">
          <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:6px;">${l}</div>
          <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:${c};">${v}</div>
        </div>`).join('')}
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
      <div>
        <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:10px;">TOP STRENGTHS</div>
        ${strengths.map(s=>`<div style="display:flex;justify-content:space-between;padding:8px 12px;background:#18181f;border-radius:6px;margin-bottom:6px;">
          <span style="font-size:11px;color:#f0f0f5;">${s.name}</span>
          <span style="font-family:'Syne',sans-serif;font-weight:700;color:${s.domain.color};">${s.score}/10</span>
        </div>`).join('')}
      </div>
      <div>
        <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:10px;">PRIORITY GAPS</div>
        ${gaps.map(s=>`<div style="display:flex;justify-content:space-between;padding:8px 12px;background:#18181f;border-left:3px solid #ff4444;border-radius:0 6px 6px 0;margin-bottom:6px;">
          <span style="font-size:11px;color:#f0f0f5;">${s.name}</span>
          <span style="font-family:'Syne',sans-serif;font-weight:700;color:#ff4444;">${s.score}/10</span>
        </div>`).join('')}
      </div>
    </div>
    ${highInit.length?`
    <div style="font-size:9px;letter-spacing:1.5px;color:#8888a0;margin-bottom:10px;">DO-NOW INITIATIVES</div>
    ${highInit.map(i=>`<div style="display:flex;justify-content:space-between;padding:10px 14px;background:#18181f;border-left:3px solid #44dd88;border-radius:0 6px 6px 0;margin-bottom:8px;">
      <span style="font-size:11px;color:#f0f0f5;">${i.name}</span>
      <span style="font-size:10px;color:#8888a0;">Impact ${i.impact}/10 ¬∑ Effort ${i.effort}/10</span>
    </div>`).join('')}`:''}
  `);
  const w = window.open('','_blank');
  w.document.write(html);
  w.document.close();
  setTimeout(() => w.print(), 400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIATIVES EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportInitiativesReport() {
  const html = buildReportHTML('Initiatives Report', `
    ${initiatives.map((init,i) => {
      const ws = initiativeWorkspaces[i] || {};
      const quad = (init.impact>=6&&init.effort<6)?'Do Now':(init.impact>=6&&init.effort>=6)?'Plan':(init.impact<6&&init.effort<6)?'Quick Win':'Deprioritize';
      const qColor = quad==='Do Now'?'#44dd88':quad==='Plan'?'#47c4ff':quad==='Quick Win'?'#ffaa00':'#ff4444';
      return `<div style="margin-bottom:20px;padding:16px;background:#18181f;border-radius:8px;border:1px solid #2a2a35;border-left:3px solid ${qColor};">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;">
          <div>
            <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:#f0f0f5;">${init.name}</div>
            <div style="font-size:10px;color:#8888a0;margin-top:3px;">${init.type} ¬∑ Impact ${init.impact}/10 ¬∑ Effort ${init.effort}/10</div>
          </div>
          <span style="padding:3px 10px;border-radius:4px;font-size:10px;font-weight:600;background:${qColor}20;color:${qColor};">${quad}</span>
        </div>
        ${ws.hypothesis?`<div style="font-size:11px;color:#f0f0f5;margin-bottom:8px;padding:8px 12px;border-left:2px solid #e8ff47;background:#0a0a0f;">${ws.hypothesis}</div>`:''}
        ${[['Owner',ws.owner],['Budget',ws.budget],['Target Date',ws.end],['Status',ws.status]].filter(([,v])=>v).map(([k,v])=>`<span style="font-size:10px;color:#8888a0;margin-right:16px;">${k}: <strong style="color:#f0f0f5;">${v}</strong></span>`).join('')}
      </div>`;
    }).join('')}
  `);
  triggerDownload(html, `initiatives-report-${getDateStr()}.html`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHARED REPORT BUILDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildReportHTML(title, content) {
  return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>${title}</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
* { box-sizing:border-box;margin:0;padding:0; }
body { background:#0a0a0f;color:#f0f0f5;font-family:'DM Mono',monospace;font-size:13px;padding:40px;max-width:1100px;margin:0 auto; }
@media print { body{background:#fff;color:#111;padding:20px;} h1{color:#000 !important;} }
h1 { font-family:'Syne',sans-serif;font-size:24px;font-weight:800;color:#e8ff47;margin-bottom:6px; }
.meta { color:#8888a0;font-size:10px;margin-bottom:28px;padding-bottom:14px;border-bottom:1px solid #2a2a35; }
</style>
</head>
<body>
<h1>${title}</h1>
<div class="meta">Generated: ${new Date().toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})} ¬∑ PM Strategy OS ¬∑ Mode: ${currentMode.toUpperCase()} ¬∑ Industry: ${currentIndustry.toUpperCase()}</div>
${content}
</body></html>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE INITIATIVES TABLE (add Open button)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const _origBuildInitiatives = buildInitiatives;
function buildInitiatives() {
  ['q1','q2','q3','q4'].forEach(q => document.getElementById(q+'Items').innerHTML = '');
  const tbody = document.getElementById('initTableBody');
  tbody.innerHTML = '';
  let highCount = 0;

  initiatives.forEach((init, i) => {
    const highImpact = init.impact >= 6;
    const highEffort = init.effort >= 6;
    const quad = highImpact && !highEffort ? 'q1' : highImpact && highEffort ? 'q2' : !highImpact && !highEffort ? 'q3' : 'q4';
    const priority = quad === 'q1' ? 'üü¢ Now' : quad === 'q2' ? 'üîµ Plan' : quad === 'q3' ? 'üü° Maybe' : 'üî¥ Deprioritize';
    if (quad === 'q1') highCount++;
    const color = quad === 'q1' ? 'var(--green)' : quad === 'q2' ? 'var(--accent3)' : quad === 'q3' ? 'var(--amber)' : 'var(--red)';
    document.getElementById(quad+'Items').innerHTML +=
      `<span class="initiative-chip" style="border-color:${color}40;color:${color}" onclick="openInitiativeOverlay(${i})">${init.name}</span>`;
    const hasWs = initiativeWorkspaces[i] && Object.values(initiativeWorkspaces[i]).some(v => v && (typeof v==='string'?v.trim():true));
    tbody.innerHTML += `
      <tr style="cursor:pointer;" onclick="openInitiativeOverlay(${i})" title="Click to open workspace">
        <td style="color:var(--text)">${init.name}${hasWs?` <span style="font-size:9px;color:var(--green);background:var(--green-dim);padding:1px 6px;border-radius:3px;margin-left:4px;">BRIEF</span>`:''}</td>
        <td style="color:var(--text2)">${init.type}</td>
        <td>
          <input type="range" min="1" max="10" value="${init.impact}" style="width:70px;" onclick="event.stopPropagation()"
            oninput="updateInitiative(${i},'impact',this.value);document.getElementById('iimpact${i}').textContent=this.value">
          <span id="iimpact${i}">${init.impact}</span>
        </td>
        <td>
          <input type="range" min="1" max="10" value="${init.effort}" style="width:70px;" onclick="event.stopPropagation()"
            oninput="updateInitiative(${i},'effort',this.value);document.getElementById('ieffort${i}').textContent=this.value">
          <span id="ieffort${i}">${init.effort}</span>
        </td>
        <td style="color:var(--text2);font-size:10px">${(init.skills||[]).join(', ')}</td>
        <td>${priority}</td>
        <td><button class="dl-btn dl-btn-primary" style="padding:3px 10px;font-size:9px;" onclick="event.stopPropagation();openInitiativeOverlay(${i})">Open ‚Üí</button></td>
      </tr>`;
  });
  document.getElementById('initHigh').textContent = highCount;
  document.getElementById('initTotal').textContent = initiatives.length;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE EVALUATION (add note icon per skill)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildEvaluation() {
  const container = document.getElementById('evaluationDomains');
  container.innerHTML = '';
  SKILL_DATA.forEach(domain => {
    const block = document.createElement('div');
    block.className = 'domain-block';
    block.style.marginBottom = '12px';
    block.style.borderColor = domain.color + '40';
    block.innerHTML = `
      <div class="domain-header" onclick="toggleDomain('${domain.id}')">
        <div class="domain-name" style="color:${domain.color}">${domain.name}</div>
        <div class="domain-score-bar">
          <div style="font-size:9px;color:var(--text2);margin-right:4px;">Weight:
            <input type="number" min="0" max="100" step="1"
              value="${Math.round(MODE_WEIGHTS[currentMode][domain.id]*100)}"
              style="width:40px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'DM Mono',monospace;font-size:11px;padding:2px 5px;"
              id="weight_${domain.id}" onchange="updateModeWeight('${domain.id}',this.value)" onclick="event.stopPropagation()">%
          </div>
          <div class="bar-track"><div class="bar-fill" id="bar_${domain.id}" style="background:${domain.color}"></div></div>
          <div class="score-chip" id="domScore_${domain.id}" style="color:${domain.color}">‚Äî</div>
          <div class="rag-dot" id="domRag_${domain.id}"></div>
        </div>
      </div>
      <div class="domain-body" id="body_${domain.id}">
        ${domain.skills.map(skill => {
          const sn = skillNotes[skill.id] || {};
          const hasNote = sn.reasoning || sn.okr || sn.improve;
          return `
          <div class="skill-row">
            <div class="skill-name">
              <strong>${skill.name}</strong>${skill.desc}
            </div>
            <div class="skill-controls">
              <button onclick="openSkillNote('${skill.id}','${skill.name}','${domain.color}')" title="Add notes & OKR"
                style="background:${hasNote?domain.color+'20':'var(--surface2)'};border:1px solid ${hasNote?domain.color+'50':'var(--border)'};border-radius:5px;padding:3px 8px;cursor:pointer;font-size:10px;color:${hasNote?domain.color:'var(--text2)'};">
                ${hasNote?'üìù Notes':'+ Note'}
              </button>
              <input type="range" min="1" max="10" step="1" value="${scores[skill.id]}"
                id="range_${skill.id}" onchange="setScore('${skill.id}',this.value)"
                oninput="setScore('${skill.id}',this.value)">
              <div class="score-display" id="score_${skill.id}" style="color:${domain.color}">${scores[skill.id]}</div>
              <div class="rag-badge rag-${getRag(scores[skill.id])}" id="rag_${skill.id}">${getRag(scores[skill.id])}</div>
            </div>
          </div>`;
        }).join('')}
      </div>
    `;
    container.appendChild(block);
  });
  updateAllDomainBars();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE FLOW MAP (nodes are now clickable)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildFlowMap() {
  const canvas = document.getElementById('flow-canvas');
  const svg = document.getElementById('flowSvg');
  const W = canvas.offsetWidth;
  const H = canvas.offsetHeight;
  canvas.querySelectorAll('.flow-node').forEach(n => n.remove());
  svg.innerHTML = '';

  FLOW_NODES.forEach(node => {
    const div = document.createElement('div');
    div.className = 'flow-node' + (node.center ? ' center-node' : '');
    div.id = 'fnode_'+node.id;
    div.innerHTML = `
      <div class="fn-title">${node.label}</div>
      <div class="fn-sub">${node.sub}</div>
      ${node.center ? `<div class="fn-score">${(Object.values(scores).reduce((a,b)=>a+b,0)/Object.values(scores).length).toFixed(1)}/10</div>` : ''}
      ${flowNodeNotes[node.id]?`<div style="font-size:8px;color:var(--accent);margin-top:4px;">üìù has notes</div>`:''}
    `;
    div.style.left = (node.x/100*W - 65) + 'px';
    div.style.top = (node.y/100*H - 35) + 'px';
    div.onclick = () => openFlowNode(node.id);
    canvas.appendChild(div);
  });

  FLOW_EDGES.forEach(edge => {
    const fromNode = FLOW_NODES.find(n => n.id === edge.from);
    const toNode = FLOW_NODES.find(n => n.id === edge.to);
    if (!fromNode || !toNode) return;
    const x1 = fromNode.x/100*W, y1 = fromNode.y/100*H;
    const x2 = toNode.x/100*W, y2 = toNode.y/100*H;
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',x1); line.setAttribute('y1',y1);
    line.setAttribute('x2',x2); line.setAttribute('y2',y2);
    line.setAttribute('stroke', edge.inverse ? '#ff4444' : 'rgba(232,255,71,0.3)');
    line.setAttribute('stroke-width', edge.w || 1);
    if (edge.dash) line.setAttribute('stroke-dasharray','5,5');
    svg.appendChild(line);
    const angle = Math.atan2(y2-y1,x2-x1);
    const ax = x2 - 14*Math.cos(angle), ay = y2 - 14*Math.sin(angle);
    const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    const size = 5;
    const pts = [[x2,y2],[ax-size*Math.sin(angle),ay+size*Math.cos(angle)],[ax+size*Math.sin(angle),ay-size*Math.cos(angle)]].map(p=>p.join(',')).join(' ');
    poly.setAttribute('points',pts);
    poly.setAttribute('fill', edge.inverse ? '#ff4444' : 'rgba(232,255,71,0.5)');
    svg.appendChild(poly);
  });
}

// ESC key closes any open overlay
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeOverlayDirect();
    closeInitOverlayDirect();
    closeFlowOverlayDirect();
    closeSkillNoteOverlayDirect();
  }
});

window.onresize = function() {
  if (document.getElementById('view-flowmap').classList.contains('active')) buildFlowMap();
};
</script>
</body>
</html>
